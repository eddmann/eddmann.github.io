<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>üïµÔ∏è Webhook Spy: A Super-Simple Serverless Webhook Spy Service - Edd Mann</title>
<meta name=description content="A walkthrough of building Webhook Spy ‚Äî a lightweight, serverless tool for capturing and inspecting webhooks using AWS Lambda and DynamoDB. Ideal for debugging third-party integrations and microservices."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="üïµÔ∏è Webhook Spy: A Super-Simple Serverless Webhook Spy Service"><meta itemprop=description content="A walkthrough of Webhook Spy ‚Äî a minimal serverless tool for inspecting webhooks and inter-service communication. Built with two Lambdas and DynamoDB, it‚Äôs fast to deploy, cheap to run, and groups requests effortlessly by path."><meta itemprop=datePublished content="2024-09-24T00:00:00+00:00"><meta itemprop=dateModified content="2024-09-24T00:00:00+00:00"><meta itemprop=wordCount content="1190"><meta itemprop=keywords content="Javascript,Aws,Serverless"><meta property="og:url" content="https://eddmann.com/posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="üïµÔ∏è Webhook Spy: A Super-Simple Serverless Webhook Spy Service"><meta property="og:description" content="A walkthrough of Webhook Spy ‚Äî a minimal serverless tool for inspecting webhooks and inter-service communication. Built with two Lambdas and DynamoDB, it‚Äôs fast to deploy, cheap to run, and groups requests effortlessly by path."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-24T00:00:00+00:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Aws"><meta property="article:tag" content="Serverless"><meta name=twitter:card content="summary"><meta name=twitter:title content="üïµÔ∏è Webhook Spy: A Super-Simple Serverless Webhook Spy Service"><meta name=twitter:description content="A walkthrough of Webhook Spy ‚Äî a minimal serverless tool for inspecting webhooks and inter-service communication. Built with two Lambdas and DynamoDB, it‚Äôs fast to deploy, cheap to run, and groups requests effortlessly by path."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.4c8b66c005db4efc68625e4ceed190f2dc110d342d05ffb19ba924cc13c3ef15.css integrity="sha256-TItmwAXbTvxoYl5M7tGQ8twRDTQtBf+xm6kkzBPD7xU="><link rel=preload as=image href=/assets/x.svg crossorigin=anonymous><link rel=preload as=image href=/assets/github.svg crossorigin=anonymous><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/><script>document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")</script><script src=/script.min.da71ac9c7b8bd4e644618df0ab735aed1393aad3cb5e5c57e5adc300fe7c8209.js integrity="sha256-2nGsnHuL1OZEYY3wq3Na7ROTqtPLXlxX5a3DAP58ggk=" defer></script></head><body><header class="site-header l-wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li><li><a href=/cv.html>CV</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=l-wrapper><article><header class=l-page-title><h1 class=u-transition-between-pages style=--id:webhook-spy-a-super-simple-serverless-webhook-spy-service>üïµÔ∏è Webhook Spy: A Super-Simple Serverless Webhook Spy Service</h1><time datetime=2024-09-24T00:00:00Z class=published-at>Sep 24, 2024</time></header><main class=u-prose><p>Have you ever wanted to peek behind the curtain and see exactly what requests your webhooks are sending, but didn&rsquo;t fancy wrestling with SaaS tools or spinning up a full-blown server? Well, I certainly did.
That&rsquo;s why I decided to build <a href=https://github.com/eddmann/webhook-spy rel="external noopener" target=_blank>Webhook Spy</a> ‚Äì a delightfully minimal, serverless webhook request logger that you can deploy and own yourself!</p><p>Let&rsquo;s embark on this journey together and see how absurdly easy (and cheap!) it is to create your own webhook spy service on AWS.
Spoiler: I got it built and running in under an hour ‚è±Ô∏è.</p><p><picture><source type=image/webp srcset="/posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_dfcc6336fa935e08.webp 350w, /posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_4f475217f043d710.webp 700w, /posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_b2212f7c9fd3e945.webp 1400w"><source type=image/jpeg srcset="/posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_7fc88c6aaac4186d.jpg 350w, /posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_1f82f1b9b3be0797.jpg 700w, /posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_fc0f1ce1d965804.jpg 1400w"><img src=/posts/webhook-spy-a-super-simple-serverless-webhook-spy-service/blueprint_hu_1f82f1b9b3be0797.jpg alt="Webhook Spy Blueprint" loading=lazy></picture></p><h2 id=why-webhook-spy>Why Webhook Spy?</h2><p>As a developer, I frequently integrate with third-party services and build systems that rely on inter-service communication (like event-driven or service-oriented architectures), each sending webhook requests to my endpoints.
While there are plenty of <a href=https://pipedream.com/requestbin rel="external noopener" target=_blank>commercial</a> <a href=https://webhook.site/ rel="external noopener" target=_blank>request</a> bin services out there, I found myself wanting:</p><ul><li>Complete control & data ownership (my requests, my rules).</li><li>No faffing about with expiring bins or complex dashboards.</li><li>A service that costs next to nothing (let&rsquo;s face it, most of these requests are just for staging).</li><li>Something I could spin up (and tear down) in minutes.</li></ul><p>And thus, Webhook Spy was born! It consists of just two AWS Lambda functions and a DynamoDB table.
One Lambda logs incoming requests to DynamoDB, while the other lists them in a pretty HTML page.
DynamoDB TTL takes care of the clean-up, so you don&rsquo;t have to lift a finger. üéâ</p><h2 id=how-it-works>How It Works</h2><p>Let&rsquo;s walk through the architecture and see how it all fits together.</p><h3 id=-components>üß© Components</h3><ol><li><strong>Spy Lambda</strong> ‚Äì Receives incoming webhook requests and stores them in DynamoDB.</li><li><strong>List Lambda</strong> ‚Äì Fetches and displays the logged requests for a given path.</li><li><strong>DynamoDB Table</strong> ‚Äì Persists the request data and automatically expires old entries.</li></ol><p>Each request is grouped by the <em>path name</em>, making it easy - and frictionless - to segment traffic for different use-cases (think <code>/stripe</code>, <code>/github</code>, or <code>/my-webhook-endpoint</code>).
You own and deploy everything, so you know where your data lives.</p><h2 id=the-code-simple-effective-and-yours>The Code: Simple, Effective, and Yours</h2><p>I promised this would be minimal, so let&rsquo;s look at the core logic.
I&rsquo;ll share both Lambda functions and the essential Serverless Framework config.</p><h3 id=1-logging-requests-the-spy-lambda>1. Logging Requests: The Spy Lambda</h3><p>This Lambda takes any incoming request, grabs all the relevant details, and drops them into DynamoDB.
It also sets an expiry timestamp, so DynamoDB can auto-delete old entries.
Here&rsquo;s the code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>DynamoDBClient</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@aws-sdk/client-dynamodb&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>DynamoDBDocumentClient</span>, <span style=color:#a6e22e>PutCommand</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@aws-sdk/lib-dynamodb&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBClient</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dynamo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DynamoDBDocumentClient</span>.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>client</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>epoch</span> <span style=color:#f92672>=</span> () =&gt; Math.<span style=color:#a6e22e>floor</span>(<span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expireInSeconds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>REQUEST_EXPIRY_AFTER_DAYS</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>24</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>dynamo</span>.<span style=color:#a6e22e>send</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PutCommand</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TableName</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TABLE_NAME</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Item</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PathName</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>rawPath</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>OccurredAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>epoch</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ExpiresAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>epoch</span>() <span style=color:#f92672>+</span> <span style=color:#a6e22e>expireInSeconds</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Request</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>event</span>),
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{}&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p><strong>What&rsquo;s going on here?</strong></p><ul><li>We capture the full request event as JSON.</li><li>Each entry is keyed by <code>PathName</code> (as the Primary Key) and <code>OccurredAt</code> (timestamp, as the Sort Key).</li><li>TTL magic: <code>ExpiresAt</code> tells DynamoDB when to auto-delete the record.</li><li>Returns a simple <code>200 OK</code> ‚Äì webhooks will be delighted.</li></ul><h3 id=2-viewing-requests-the-list-lambda>2. Viewing Requests: The List Lambda</h3><p>Now for the fun part: seeing what arrived!
This Lambda queries DynamoDB for all requests to a certain path, then renders them in a friendly HTML page.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>DynamoDBClient</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@aws-sdk/client-dynamodb&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DynamoDBDocumentClient</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>QueryCommand</span>,
</span></span><span style=display:flex><span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@aws-sdk/lib-dynamodb&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DynamoDBClient</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dynamo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DynamoDBDocumentClient</span>.<span style=color:#a6e22e>from</span>(<span style=color:#a6e22e>client</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span>.<span style=color:#a6e22e>handler</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>results</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>dynamo</span>.<span style=color:#a6e22e>send</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>QueryCommand</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>TableName</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TABLE_NAME</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>KeyConditionExpression</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;PathName = :pathName&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ExpressionAttributeValues</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#39;:pathName&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>rawPath</span> },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ScanIndexForward</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>statusCode</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;text/html&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;title&gt;Webhook Spy&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &lt;h1&gt;Webhook Spy&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &lt;div&gt;Path: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>rawPath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>results</span>.<span style=color:#a6e22e>Items</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>result</span> =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>request</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Request</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>          <span style=color:#e6db74>}</span><span style=color:#e6db74> catch (e) {}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          return `</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>time</span> <span style=color:#a6e22e>datetime</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;${result.OccurredAt}&#34;</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/time&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>pre</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>$</span>{<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>requestContext</span>.<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>requestContext</span>.<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>path</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>rawQueryString</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>protocol</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>requestContext</span>.<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>protocol</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>sourceIp</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>requestContext</span>.<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>sourceIp</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>,
</span></span><span style=display:flex><span>                  <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>body</span>,
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>              )}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/pre&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>`;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }).join(&#39;\n&#39;)}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;script&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          [...document.getElementsByTagName(&#39;time&#39;)].forEach((time) =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            time.innerHTML = new Date(time.getAttribute(&#39;datetime&#39;) * 1e3).toLocaleString();
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          });
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/script&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    `</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p><strong>Highlights:</strong></p><ul><li>Relevant path-based results are sorted with the newest entries shown first.</li><li>Each request is rendered in a readable format, with headers, query string, body, and more. If the request body contains JSON, we attempt to prettify it as well.</li><li>Light CSS styling is applied for better readability.</li></ul><h3 id=3-the-serverless-framework-setup>3. The Serverless Framework Setup</h3><p>You can deploy the whole service with the <a href=https://www.serverless.com/ rel="external noopener" target=_blank>Serverless Framework</a>.
Here&rsquo;s the <code>serverless.yml</code> that glues it all together:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>: <span style=color:#ae81ff>webhook-spy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>frameworkVersion</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tableName</span>: <span style=color:#ae81ff>${self:service}-${opt:stage}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>requestExpiryAfterDays</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>provider</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runtime</span>: <span style=color:#ae81ff>nodejs20.x</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>iam</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>role</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>statements</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Action</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>dynamodb:Query</span>
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>dynamodb:PutItem</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Resource</span>:
</span></span><span style=display:flex><span>            - <span style=color:#f92672>&#39;Fn::GetAtt&#39;</span>: [<span style=color:#ae81ff>Table, Arn]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>TABLE_NAME</span>: <span style=color:#ae81ff>${self:custom.tableName}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>functions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>spy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>handler</span>: <span style=color:#ae81ff>spy.handler</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>REQUEST_EXPIRY_AFTER_DAYS</span>: <span style=color:#ae81ff>${self:custom.requestExpiryAfterDays}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>list</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>handler</span>: <span style=color:#ae81ff>list.handler</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Table</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::DynamoDB::Table</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>TableName</span>: <span style=color:#ae81ff>${self:custom.tableName}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>AttributeDefinitions</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>AttributeName</span>: <span style=color:#ae81ff>PathName</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>AttributeType</span>: <span style=color:#ae81ff>S</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>AttributeName</span>: <span style=color:#ae81ff>OccurredAt</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>AttributeType</span>: <span style=color:#66d9ef>N</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>KeySchema</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>AttributeName</span>: <span style=color:#ae81ff>PathName</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>KeyType</span>: <span style=color:#ae81ff>HASH</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>AttributeName</span>: <span style=color:#ae81ff>OccurredAt</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>KeyType</span>: <span style=color:#ae81ff>RANGE</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>TimeToLiveSpecification</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>AttributeName</span>: <span style=color:#e6db74>&#39;ExpiresAt&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>BillingMode</span>: <span style=color:#ae81ff>PAY_PER_REQUEST</span>
</span></span></code></pre></div><p><strong>What I love about this:</strong></p><ul><li><strong>PAY_PER_REQUEST</strong>: No idle costs, only charged for what you use.</li><li><strong>Automatic cleanup</strong>: DynamoDB handles deleting old requests. No cron jobs, scripts, or post-it notes required.</li><li><strong>Minimal AWS resources</strong>: Just a few services (Lambda, DynamoDB), all provisioned and decommissioned via this single configuration file.</li></ul><h2 id=deploying-and-using-webhook-spy>Deploying and Using Webhook Spy</h2><p>Ready to give it a go? Here&rsquo;s the step-by-step:</p><ol><li>Clone the <a href=https://github.com/eddmann/webhook-spy rel="external noopener" target=_blank>repository</a>.</li><li><em>(Optional)</em> Edit <code>custom.requestExpiryAfterDays</code> in <code>serverless.yml</code> to set your preferred retention period.</li><li>Deploy with Serverless Framework: <code>npx serverless deploy --stage dev</code></li><li>Pick a path name for your webhook group (e.g. <code>/stripe</code>).</li><li>Point your webhook sender to: <code>https://spy-lambda-function-url/{path-name}</code></li><li>Visit the list endpoint to view requests: <code>https://list-lambda-function-url/{path-name}</code></li></ol><p>And that&rsquo;s it! No third-party dashboards, no hidden costs, no expiring endpoints (unless <em>you</em> want them to expire).
Just pure, hands-on webhook spying goodness.</p><h2 id=reflections-lessons-and-whats-next>Reflections, Lessons, and What&rsquo;s Next</h2><p>I love little projects like this.
They scratch an itch, teach me something new, and (let&rsquo;s be honest) give me an excuse to play with AWS.
Lambda URLs are a perfect fit for this use case and reduce the required AWS resources needed for tiny utilities like this.</p><p><strong>What went well:</strong></p><ul><li>The whole thing fits comfortably in my head (and in a single blog post).</li><li>DynamoDB TTL means zero maintenance. I can forget about it and it&rsquo;ll quietly clean itself up.</li><li>The cost is almost unnoticeable, even with frequent webhook testing.</li></ul><p><strong>Areas to improve (and possible future work):</strong></p><ul><li>Add response stubs (beyond just 200s), maybe configurable via query params.</li><li>Authentication! Right now, this is open to anyone with the URL, which amounts to security through obscurity ‚Äî not ideal.</li><li>Better search features: filtering by date, method, etc. ‚Äì could be handy for those &ldquo;why did it POST at 2am?&rdquo; moments.</li></ul><h2 id=over-to-you->Over to You! üöÄ</h2><p>If you&rsquo;ve ever needed a quick, private webhook bin for your staging or dev environment, I hope you&rsquo;ll find this as handy as I do.
Feel free to <a href=https://github.com/eddmann/webhook-spy rel="external noopener" target=_blank>fork the code</a> or adapt it for your own use cases.</p></main><footer class=post-footer><ul class="tags tags--large"><li><a href=/archive/tag/javascript>javascript</a></li><li><a href=/archive/tag/aws>aws</a></li><li><a href=/archive/tag/serverless>serverless</a></li></ul><div class=related><h3 class=related__title>Related Posts</h3><ul class=related__posts><li><a href=/posts/exploring-nextjs-14-at-full-throttle-an-f1-picks-rebuild/>Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild</a></li><li><a href=/posts/mince-pie-challenge-viewing-and-removing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Viewing and Removing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/mince-pie-challenge-adding-and-listing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Adding and Listing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/mince-pie-challenge-building-a-serverless-restful-api-and-react-client/>Mince Pie Challenge: Building a Serverless RESTful API and React Client</a></li><li><a href=/posts/creating-a-winning-audio-lambda-service-using-serverless-polly-and-compiled-sox/>Creating a 'Winning' Audio Lambda Service using Serverless, Polly and compiled SOX</a></li></ul></div></footer></article><div class="podcast-ad u-overlay-wrapper"><div class=podcast-ad__artwork><img src=https://compiledconversations.com/album-art.jpg alt="Compiled Conversations podcast album art" class=podcast-ad__artwork-image></div><div class=podcast-ad__content><h3 class=podcast-ad__title>Compiled Conversations</h3><p class=podcast-ad__description>Podcast I host, featuring conversations with the people shaping software and technology.</p><div class=podcast-ad__link>Check out the show</a></div><a class=u-overlay href=https://compiledconversations.com target=_blank>Listen to Compiled Conversations</a></div><div class=scroll-watcher></div></main><footer class="site-footer l-wrapper"><div>&copy; 2025, Edd Mann</div><button class=site-footer__theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>