<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn how to evaluate Reverse Polish Notation (RPN) expressions in Scala using both mutable stack and functional programming approaches with practical code examples.">

    <title>
        
            Reverse Polish Notation (RPN) in Scala &middot; Edd Mann
        
    </title>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    

    <script>
        var _gaq=[['_setAccount','UA-32512081-1'],['_setDomainName','eddmann.com'],['_trackPageview']];
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = 'https://ssl.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Reverse Polish Notation (RPN) in Scala</h1>
    <time datetime="2013-12-15T00:00:00+00:00" class="post-date">15 Dec 2013</time>
    <p>Continuing on with my exploration of the Scala language, I decided to solve the widely documented problem of evaluating a mathematical <a href="http://en.wikipedia.org/wiki/Reverse_Polish_Notation">Reverse Polish notation</a> string.
Popularised by its use in the <a href="http://en.wikipedia.org/wiki/HP-10C_series">HP-10C</a> series of calculators from the 1980s, the notation requires that every operator follow its operands (otherwise called postfix notation).</p>



<p>For simplification, both discussed solutions use the partially-applied ‘parse’ function below, which is simply an alias for Java’s ‘parseDouble’ method.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse</span> <span class="k">=</span> <span class="nv">java</span><span class="o">.</span><span class="py">lang</span><span class="o">.</span><span class="py">Double</span><span class="o">.</span><span class="py">parseDouble</span> <span class="k">_</span>
</code></pre></div></div>

<h2 id="mutable-stack">Mutable Stack</h2>

<p>A typical solution to this problem is to use a mutable stack, which, based on the current token, either pushes the parsed number or the operator result back onto the stack.
Once you have iterated over each of the split string tokens, you will be left with a single item, which is your result.
Although this solution uses mutability (a big functional no-no), I was able to take advantage of Scala’s first-class function support for the operator map.
As addition and multiplication operations both have the symmetric property, I was able to ignore the stack’s last-in-first-out (LIFO) nature in this case.
However, regarding the minus and divide operations, I was required to swap the parameter values around before evaluating and returning the result.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rpn</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>

    <span class="k">val</span> <span class="nv">ops</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
        <span class="s">"+"</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="k">_:</span> <span class="kt">Double</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="k">_:</span> <span class="kt">Double</span><span class="o">)),</span>
        <span class="s">"*"</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="k">_:</span> <span class="kt">Double</span><span class="o">)</span> <span class="o">*</span> <span class="o">(</span><span class="k">_:</span> <span class="kt">Double</span><span class="o">)),</span>
        <span class="s">"-"</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">),</span>
        <span class="s">"/"</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="o">/</span> <span class="n">x</span><span class="o">)</span>
    <span class="o">)</span>

    <span class="k">val</span> <span class="nv">stack</span> <span class="k">=</span> <span class="k">new</span> <span class="nv">scala</span><span class="o">.</span><span class="py">collection</span><span class="o">.</span><span class="py">mutable</span><span class="o">.</span><span class="py">Stack</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>

    <span class="nv">str</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="sc">' '</span><span class="o">).</span><span class="py">foreach</span><span class="o">(</span><span class="n">token</span> <span class="k">=&gt;</span>
        <span class="nv">stack</span><span class="o">.</span><span class="py">push</span><span class="o">(</span>
            <span class="nf">if</span> <span class="o">(</span><span class="nv">ops</span><span class="o">.</span><span class="py">contains</span><span class="o">(</span><span class="n">token</span><span class="o">))</span> <span class="nf">ops</span><span class="o">(</span><span class="n">token</span><span class="o">)(</span><span class="nv">stack</span><span class="o">.</span><span class="py">pop</span><span class="o">,</span> <span class="nv">stack</span><span class="o">.</span><span class="py">pop</span><span class="o">)</span>
            <span class="k">else</span> <span class="nf">parse</span><span class="o">(</span><span class="n">token</span><span class="o">)</span>
        <span class="o">))</span>

    <span class="nv">stack</span><span class="o">.</span><span class="py">pop</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="pattern-matching">Pattern-Matching</h2>

<p>Following on from the above mutable approach, I was able to implement a solution that follows the side-effect-free functional paradigm.
In this instance, I am instead performing a left-fold over the split string, then using pattern matching to evaluate each token and the current state of the stack (list).
By this use of pattern matching, I am similarly, in effect, ‘popping’ off the last two operands when I encounter an operator token.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rpn</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>

    <span class="nv">str</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="sc">' '</span><span class="o">).</span><span class="py">toList</span><span class="o">.</span><span class="py">foldLeft</span><span class="o">(</span><span class="nc">List</span><span class="o">[</span><span class="kt">Double</span><span class="o">]())(</span>
        <span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">token</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">token</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
            <span class="nf">case</span> <span class="o">(</span><span class="n">x</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="n">zs</span><span class="o">,</span> <span class="s">"*"</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span> <span class="o">::</span> <span class="n">zs</span>
            <span class="nf">case</span> <span class="o">(</span><span class="n">x</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="n">zs</span><span class="o">,</span> <span class="s">"+"</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">)</span> <span class="o">::</span> <span class="n">zs</span>
            <span class="nf">case</span> <span class="o">(</span><span class="n">x</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="n">zs</span><span class="o">,</span> <span class="s">"-"</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">::</span> <span class="n">zs</span>
            <span class="nf">case</span> <span class="o">(</span><span class="n">x</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="n">zs</span><span class="o">,</span> <span class="s">"/"</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">x</span><span class="o">)</span> <span class="o">::</span> <span class="n">zs</span>
            <span class="nf">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nf">parse</span><span class="o">(</span><span class="n">token</span><span class="o">)</span> <span class="o">::</span> <span class="n">list</span>
        <span class="o">}).</span><span class="py">head</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Finally, both implementations, when run with the following RPN string argument, will return a double value of 8.0.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">rpn</span><span class="o">(</span><span class="s">"4 2 * 8 + 2 /"</span><span class="o">)</span> <span class="c1">// 8.0</span>
</code></pre></div></div>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
