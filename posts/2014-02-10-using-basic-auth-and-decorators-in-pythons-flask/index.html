<p>I have recently set aside some time to delve into the world of Python and all its Zen.
Being a web developer at heart, I, of course, had to look at the current options available to me.
In this post, I will guide you through creating a single-script web application using Flask and basic access authentication.
For simplicity, I assume that you have a working installation of either Python 2.7/3.3 and <a href="http://www.virtualenv.org/en/latest/index.html">virtualenv</a>.</p>

<!--more-->

<h2 id="project-setup">Project Setup</h2>

<p>We must first set up a new virtual environment to cleanly handle external dependencies, similar to <a href="https://getcomposer.org/">Composer</a> in the PHP ecosystem.
As Python libraries are shared at the system level by default, virtualenv provides projects with their own custom installation directories.
This resolves the issue of different projects requiring different versions of the same package.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>virtualenv venv
<span class="nv">$ </span><span class="nb">source </span>venv/bin/activate
<span class="nv">$ </span>pip <span class="nb">install </span>Flask
</code></pre></div></div>

<p>Using the commands provided above, we first create a new virtual environment called ‘venv’ in the project’s root directory.
To configure the Python, pip, etc. commands to take notice of the custom installation directories within the current shell instance, we must source the ‘activate’ script.
Finally, we install Flask using the typical pip command.</p>

<h2 id="the-application">The Application</h2>

<p>We are now ready to implement the web application logic.
A design decision I have made is to separate the login credentials into their own settings file.
This is good practice, and with Python’s “everything is an object” philosophy, defining the file is easy.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USER</span><span class="o">=</span><span class="s">'admin'</span>
<span class="n">PASS</span><span class="o">=</span><span class="s">'password'</span>
</code></pre></div></div>

<p>As you can see, the file requires no boilerplate code and simply specifies the two desired variables.
With the settings now defined, we can move on to implementing the web application itself.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'settings'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">valid_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">username</span> <span class="o">==</span> <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'USER'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'PASS'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">authorization</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">.</span><span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">auth</span><span class="p">.</span><span class="n">password</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">valid_credentials</span><span class="p">(</span><span class="n">auth</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">auth</span><span class="p">.</span><span class="n">password</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s">'Login!'</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="p">{</span><span class="s">'WWW-Authenticate'</span><span class="p">:</span> <span class="s">'Basic realm="Login!"'</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'Hello, world!'</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/secure'</span><span class="p">)</span>
<span class="o">@</span><span class="n">authenticate</span>
<span class="k">def</span> <span class="nf">secure</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'Secure!'</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Using Flask’s ability to import configuration options from external objects, we are able to access the specified credentials in the <code class="language-plaintext highlighter-rouge">valid_credentials</code> function.
To provide the ‘secure’ route with the required basic authentication, I created a simple wrapper method which is used to decorate the route.
Decorators are a super simple, yet increasingly powerful concept, allowing you to wrap function calls with other functions in a very succinct manner.
As this is an experiment, I have specified that the application be run in debug mode, enabling auto-reloading of updated files within the local development server.
Finally, we are ready to run the application.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python main.py
<span class="nv">$ </span>pip freeze <span class="o">&gt;</span> requirements.txt
</code></pre></div></div>

<p>After checking to make sure that our handiwork has been successful, we can freeze the required dependencies so as to ease future development and deployment.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://www.virtualenv.org/en/latest/index.html">virtualenv</a></li>
  <li><a href="https://pypi.python.org/pypi">PyPI</a></li>
  <li><a href="http://flask.pocoo.org/">Flask</a></li>
  <li><a href="http://flask.pocoo.org/snippets/8/">HTTP Basic Auth</a></li>
</ul>
