<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Building a Nokia Composer (RTTTL) Player and WAV-file Generator in the Browser - Edd Mann</title>
<meta name=description content="Learn how to parse, play and generate WAV-files from Nokia (RTTTL) ringtones using the Web Audio API and JavaScript in the browser."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Building a Nokia Composer (RTTTL) Player and WAV-file Generator in the Browser"><meta itemprop=description content="Who remembers punching in key-combinations found online into their Nokia 3210 to create custom ringtones? I spent more time than I would care to admit doing this in my youth. Over the weekend I decided, as a bit of a nostalgic exercise, to see if I could implement a Nokia Composer clone using JavaScript and the Web Audio API. From here, I expanded on the player to provide the ability to download the generated ringtone as a WAV file."><meta itemprop=datePublished content="2020-10-26T00:00:00+00:00"><meta itemprop=dateModified content="2020-10-26T00:00:00+00:00"><meta itemprop=wordCount content="1615"><meta itemprop=keywords content="Javascript,Web-Audio"><meta property="og:url" content="https://eddmann.com/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Building a Nokia Composer (RTTTL) Player and WAV-file Generator in the Browser"><meta property="og:description" content="Who remembers punching in key-combinations found online into their Nokia 3210 to create custom ringtones? I spent more time than I would care to admit doing this in my youth. Over the weekend I decided, as a bit of a nostalgic exercise, to see if I could implement a Nokia Composer clone using JavaScript and the Web Audio API. From here, I expanded on the player to provide the ability to download the generated ringtone as a WAV file."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-10-26T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-26T00:00:00+00:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Web-Audio"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a Nokia Composer (RTTTL) Player and WAV-file Generator in the Browser"><meta name=twitter:description content="Who remembers punching in key-combinations found online into their Nokia 3210 to create custom ringtones? I spent more time than I would care to admit doing this in my youth. Over the weekend I decided, as a bit of a nostalgic exercise, to see if I could implement a Nokia Composer clone using JavaScript and the Web Audio API. From here, I expanded on the player to provide the ability to download the generated ringtone as a WAV file."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.094c8c11875f4921a4fa157fbb0e4a483b9d415d48f335d2effb5818cee90471.css integrity="sha256-CUyMEYdfSSGk+hV/uw5KSDudQV1I8zXS7/tYGM7pBHE="><link rel=preload as=image href=/assets/x.svg crossorigin=anonymous><link rel=preload as=image href=/assets/github.svg crossorigin=anonymous><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/><script>document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")</script><script src=/script.min.164d56ac6f4c8613b0b7109fd1b4d9dfdce1d004edab8e1afb7240013f9221d7.js integrity="sha256-Fk1WrG9MhhOwtxCf0bTZ39zh0ATtq44a+3JAAT+SIdc=" defer></script></head><body><header class="site-header l-wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=l-wrapper><article><header class=l-page-title><h1 class=u-transition-between-pages style=--id:building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser>Building a Nokia Composer (RTTTL) Player and WAV-file Generator in the Browser</h1><time datetime=2020-10-26T00:00:00Z class=published-at>Oct 26, 2020</time></header><main class=u-prose><p>Who remembers punching in key-combinations found online into their Nokia 3210 to create <em>custom ringtones</em>?
I spent more time than I would care to admit doing this in my youth.
Over the weekend I decided, as a bit of a nostalgic exercise, to see if I could implement a <a href=https://nokia.fandom.com/wiki/Composer rel="external noopener" target=_blank>Nokia Composer</a> clone using JavaScript and the <a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API rel="external noopener" target=_blank>Web Audio API</a>.
From here, I expanded on the player to provide the ability to download the generated ringtone as a WAV file.</p><p>The finished <a href=https://eddmann.com/nokia-composer-web/>player and WAV-file generator</a> is available to experiment with and code-review on <a href=https://github.com/eddmann/nokia-composer-web rel="external noopener" target=_blank>GitHub</a>.</p><p><a href=https://eddmann.com/nokia-composer-web/><picture><source type=image/webp srcset="/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_3614f204ad1712d4.webp 350w, /posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_ab1447a46047f068.webp 700w, /posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_85649cfbd330bbcc.webp 1400w"><source type=image/jpeg srcset="/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_2154410db5244707.jpg 350w, /posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_2f2e726db1a3f115.jpg 700w, /posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_5019893338a0ef68.jpg 1400w"><img src=/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/demo_hu_2f2e726db1a3f115.jpg alt="Nokia Composer (RTTTL) Player" loading=lazy></picture></a></p><p>I decided to leverage in-line <a href=https://reactjs.org/docs/add-react-to-a-website.html rel="external noopener" target=_blank>React and Babel</a> so as to keep all the logic on a single webpage.
This makes for a more succinct demo and provides the ability to automatically highlight the required code in-line.</p><h2 id=parsing-rtttl>Parsing RTTTL</h2><pre tabindex=0><code>A-Team:d=8,o=5,b=125:4d#6,a#,2d#6,16p,g#,4a#,4d#.,p,16g,16a#,d#6,a#,f6,2d#6,16p,c#.6,16c6,16a#,g#.,2a#
</code></pre><p>The above may look familiar to anyone who owned a Nokia in the early 2000s.
This is an example of the Ring Tone Transfer Language (RTTTL) which was developed by Nokia to represent ringtones on their mobile devices.
Using the <a href=http://merwin.bespin.org/t4a/specs/nokia_rtttl.txt rel="external noopener" target=_blank>provided specification</a> (in Backusâ€“Naur form), we can see that the input can be broken up into <em>three</em> distinct parts:</p><ul><li><strong>Name</strong> â€“ the name of the melody, which consists of a maximum of 10 characters.</li><li><strong>Defaults</strong> â€“ the octave, duration and beat to default to if one is not specified in the given melody note (duration=4, octave=6, beat=63).</li><li><strong>Melody</strong> â€“ a comma-separated listing of the notes, including optional duration, octave and <em>special-duration</em> dot.</li></ul><p>I used this specification to begin parsing the input using JavaScript.
Parsing the <em>name</em> attribute was omitted as this was not required to complete the scoped demonstration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toDefaults</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>unparsedDefaults</span> =&gt;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>unparsedDefaults</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;,&#34;</span>).<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>defaults</span>, <span style=color:#a6e22e>option</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>option</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;=&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>key</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;d&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> { ...<span style=color:#a6e22e>defaults</span>, <span style=color:#a6e22e>duration</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>value</span> };
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;o&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> { ...<span style=color:#a6e22e>defaults</span>, <span style=color:#a6e22e>octave</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>value</span> };
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;b&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> { ...<span style=color:#a6e22e>defaults</span>, <span style=color:#a6e22e>beat</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>value</span> };
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>defaults</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>duration</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>octave</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>6</span>, <span style=color:#a6e22e>beat</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>63</span> }
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toMelody</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>melody</span>, <span style=color:#a6e22e>defaults</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ..
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>melody</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;,&#34;</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>unparsedNote</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>groups</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>parsed</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>unparsedNote</span>.<span style=color:#a6e22e>match</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>/(?&lt;duration&gt;1|2|4|8|16|32|64)?(?&lt;note&gt;(?:[a-g]|p)#?){1}(?&lt;dot&gt;\.?)(?&lt;octave&gt;4|5|6|7)?/</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>note</span>, <span style=color:#a6e22e>dot</span>, <span style=color:#a6e22e>octave</span>, <span style=color:#a6e22e>beat</span> } <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>parsed</span>).<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>xs</span>, <span style=color:#a6e22e>x</span>) =&gt; (<span style=color:#a6e22e>parsed</span>[<span style=color:#a6e22e>x</span>] <span style=color:#f92672>?</span> { ...<span style=color:#a6e22e>xs</span>, [<span style=color:#a6e22e>x</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>parsed</span>[<span style=color:#a6e22e>x</span>] } <span style=color:#f92672>:</span> <span style=color:#a6e22e>xs</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>defaults</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ..
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  });
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parse</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rtttl</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>unparsedDefaults</span>, <span style=color:#a6e22e>unparsedMelody</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>rtttl</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;:&#34;</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>toMelody</span>(<span style=color:#a6e22e>unparsedMelody</span>, <span style=color:#a6e22e>toDefaults</span>(<span style=color:#a6e22e>unparsedDefaults</span>));
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Looking at the above code, you can see the described sections are broken apart, with the default values and melody notes subsequently being parsed individually.
The default values are parsed first so as to have these available when parsing the melody section.
Using the supplied specification, I was able to ensure that only valid melody notes were parsed.
I found that using regular expression named capture groups provided a very elegant means to produce the defined values per note (providing defaults were used where there were omissions).</p><h2 id=a-tiny-bit-of-music-theory>A Tiny Bit of Music Theory</h2><p>With the RTTTL now parsed, my next objective was to translate the defined note/octaves of the melody into frequencies which I could send to the <a href=https://modernweb.com/creating-sound-with-the-web-audio-api-and-oscillators/ rel="external noopener" target=_blank>Oscillator</a>.
This led me to research the <a href=https://en.wikipedia.org/wiki/Equal_temperament rel="external noopener" target=_blank>Twelve-Tone Equal Temperament</a> system of tuning.
Using this system and a little bit of maths, we are able to calculate the frequency of a given note/octave using a known <em>base</em> note frequency.
Typically, <code>A4</code> (also known as <a href=https://en.wikipedia.org/wiki/A440_%28pitch_standard%29 rel="external noopener" target=_blank>Stuttgart pitch</a>, 440Hz) is used as the base frequency from which all calculations are done; however, I noticed that if I instead use <code>C4</code> (<a href=https://en.wikipedia.org/wiki/C_%28musical_note%29#Middle_C rel="external noopener" target=_blank>Middle-C</a>, 261.63Hz), it would save some offset maths calculations from being required.</p><p>The formula below provides the ability to calculate the octave frequency of a given note.</p><p><img src=/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/octave-formula.gif alt="Octave Formula" loading=lazy></p><p>This formula can be used to calculate the octave one lower and one higher than the provided frequency (in this case <code>C4</code>) as shown in JavaScript:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>261.63</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>C3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span>); <span style=color:#75715e>// 130.81
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>C5</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> (<span style=color:#ae81ff>5</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span>); <span style=color:#75715e>// 523.26
</span></span></span></code></pre></div><p>Furthermore, the formula below provides the ability to calculate the frequency of a desired note.
This uses the offset from the base note within the scale (<code>c, c#, d, d#, e, f, f#, g, g#, a, a#, b</code>) to determine the frequency.</p><p><img src=/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/note-formula.gif alt="Note Formula" loading=lazy></p><p>This formula can again be implemented in JavaScript to calculate the note one lower and one higher than the provided frequency (in this case <code>C4</code>).
Notice that using <code>C</code> as the base note allows the omission of any offset calculation needing to be applied, thanks to the array being zero-indexed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NOTES</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;c&#34;</span>, <span style=color:#e6db74>&#34;c#&#34;</span>, <span style=color:#e6db74>&#34;d&#34;</span>, <span style=color:#e6db74>&#34;d#&#34;</span>, <span style=color:#e6db74>&#34;e&#34;</span>, <span style=color:#e6db74>&#34;f&#34;</span>, <span style=color:#e6db74>&#34;f#&#34;</span>, <span style=color:#e6db74>&#34;g&#34;</span>, <span style=color:#e6db74>&#34;g#&#34;</span>, <span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;a#&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>261.63</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>B4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> (<span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;b&#34;</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>12</span>); <span style=color:#75715e>// 493.89
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>D4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>C4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> (<span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#e6db74>&#34;d&#34;</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>12</span>); <span style=color:#75715e>// 293.69
</span></span></span></code></pre></div><p>Finally, the two formulas can be combined to calculate the desired note/octave from a given reference point.</p><p><img src=/posts/building-a-nokia-composer-rtttl-player-and-wav-file-generator-in-the-browser/note-octave-formula.gif alt="Note/Octave Formula" loading=lazy></p><p>This formula can then be used to generate the frequencies for all notes/octaves, producing a scale.
Providing any valid base frequency will, in turn, produce the same exact scale representation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NOTES</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;c&#34;</span>, <span style=color:#e6db74>&#34;c#&#34;</span>, <span style=color:#e6db74>&#34;d&#34;</span>, <span style=color:#e6db74>&#34;d#&#34;</span>, <span style=color:#e6db74>&#34;e&#34;</span>, <span style=color:#e6db74>&#34;f&#34;</span>, <span style=color:#e6db74>&#34;f#&#34;</span>, <span style=color:#e6db74>&#34;g&#34;</span>, <span style=color:#e6db74>&#34;g#&#34;</span>, <span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;a#&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>scales</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>baseNote</span>, <span style=color:#a6e22e>baseOctave</span>, <span style=color:#a6e22e>baseFrequency</span>) =&gt;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>scale</span>, <span style=color:#a6e22e>note</span>) =&gt;
</span></span><span style=display:flex><span>      [...Array(<span style=color:#ae81ff>9</span>).<span style=color:#a6e22e>keys</span>()].<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>scale</span>, <span style=color:#a6e22e>octave</span>) =&gt; ({
</span></span><span style=display:flex><span>          ...<span style=color:#a6e22e>scale</span>,
</span></span><span style=display:flex><span>          [<span style=color:#a6e22e>note</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>octave</span>]<span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>baseFrequency</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span>
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>octave</span> <span style=color:#f92672>-</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>baseOctave</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>note</span>) <span style=color:#f92672>-</span> <span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>baseNote</span>)) <span style=color:#f92672>/</span> <span style=color:#a6e22e>NOTES</span>.<span style=color:#a6e22e>length</span>),
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>scale</span>
</span></span><span style=display:flex><span>      ),
</span></span><span style=display:flex><span>    {}
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>scales</span>(<span style=color:#e6db74>&#34;c&#34;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>261.63</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>scales</span>(<span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>440</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>scales</span>(<span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>27.5</span>);
</span></span></code></pre></div><p>I used this exploration exercise as the basis to complete parsing the RTTTL input into a playable form.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toMelody</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>melody</span>, <span style=color:#a6e22e>defaults</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>notes</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;c&#34;</span>, <span style=color:#e6db74>&#34;c#&#34;</span>, <span style=color:#e6db74>&#34;d&#34;</span>, <span style=color:#e6db74>&#34;d#&#34;</span>, <span style=color:#e6db74>&#34;e&#34;</span>, <span style=color:#e6db74>&#34;f&#34;</span>, <span style=color:#e6db74>&#34;f#&#34;</span>, <span style=color:#e6db74>&#34;g&#34;</span>, <span style=color:#e6db74>&#34;g#&#34;</span>, <span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;a#&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>middleC</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>261.63</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>melody</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;,&#34;</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>unparsedNote</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>groups</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>parsed</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>unparsedNote</span>.<span style=color:#a6e22e>match</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>/(?&lt;duration&gt;1|2|4|8|16|32|64)?(?&lt;note&gt;(?:[a-g]|p)#?){1}(?&lt;dot&gt;\.?)(?&lt;octave&gt;4|5|6|7)?/</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>note</span>, <span style=color:#a6e22e>dot</span>, <span style=color:#a6e22e>octave</span>, <span style=color:#a6e22e>beat</span> } <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>parsed</span>).<span style=color:#a6e22e>reduce</span>(
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>xs</span>, <span style=color:#a6e22e>x</span>) =&gt; (<span style=color:#a6e22e>parsed</span>[<span style=color:#a6e22e>x</span>] <span style=color:#f92672>?</span> { ...<span style=color:#a6e22e>xs</span>, [<span style=color:#a6e22e>x</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>parsed</span>[<span style=color:#a6e22e>x</span>] } <span style=color:#f92672>:</span> <span style=color:#a6e22e>xs</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>defaults</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>duration</span><span style=color:#f92672>:</span> (<span style=color:#ae81ff>240</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>beat</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>duration</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>dot</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.5</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>frequency</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>note</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;p&#34;</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>middleC</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>**</span> (<span style=color:#a6e22e>octave</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>notes</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>note</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>12</span>),
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>With this in place, the <code>parse</code> function now returns an ordered listing of all the note durations and frequencies based on the supplied RTTTL.</p><h2 id=getting-it-to-play>Getting it to Play</h2><p>From here, I then created a simple React component which provided the ability to supply a given RTTTL composition and play it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>NokiaComposer</span>({ <span style=color:#a6e22e>melodies</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>isPlaying</span>, <span style=color:#a6e22e>setPlaying</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useState</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>composition</span>, <span style=color:#a6e22e>setComposition</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useState</span>(<span style=color:#a6e22e>melodies</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>useEffect</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isPlaying</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>audio</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AudioContext</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>oscillator</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>createOscillator</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;square&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>destination</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>onended</span> <span style=color:#f92672>=</span> () =&gt; <span style=color:#a6e22e>setPlaying</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>time</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>composition</span>).<span style=color:#a6e22e>forEach</span>(({ <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>frequency</span> }) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>frequency</span>.<span style=color:#a6e22e>setValueAtTime</span>(<span style=color:#a6e22e>frequency</span>, <span style=color:#a6e22e>time</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>time</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>duration</span>;
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>stop</span>(<span style=color:#a6e22e>time</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }, [<span style=color:#a6e22e>isPlaying</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Using the parsed RTTTL and the Web Audio API&rsquo;s <code>AudioContext</code>/<code>Oscillator</code>, I am able to cycle through the melody, ensuring that the given frequency is set for the desired duration within the Oscillator.
This completed the implementation required to play the composition within the browser ðŸŽ‰.</p><h2 id=generating-wav-files>Generating WAV files</h2><p>The final step to this demonstration was adding the ability to generate a WAV file from the supplied RTTTL composition.
Thanks to the <code>OfflineAudioContext</code>, I was able to employ the same logic described above to generate an in-memory <code>AudioBuffer</code> representation of the melody.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>generateAudioBuffer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>rtttl</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>melody</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>rtttl</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>totalDuration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>melody</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>total</span>, { <span style=color:#a6e22e>duration</span> }) =&gt; <span style=color:#a6e22e>total</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>duration</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>audio</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>OfflineAudioContext</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>totalDuration</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>44100</span>, <span style=color:#ae81ff>44100</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>oscillator</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>createOscillator</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;square&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>destination</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>time</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>melody</span>.<span style=color:#a6e22e>forEach</span>(({ <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>frequency</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>frequency</span>.<span style=color:#a6e22e>setValueAtTime</span>(<span style=color:#a6e22e>frequency</span>, <span style=color:#a6e22e>time</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>duration</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>oscillator</span>.<span style=color:#a6e22e>stop</span>(<span style=color:#a6e22e>time</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>startRendering</span>();
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>From here, I spent a little time <a href=http://soundfile.sapp.org/doc/WaveFormat/ rel="external noopener" target=_blank>researching</a> into how a WAV file was formed, electing to create a 32-bit floating-point WAV file representation of the melody.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>generateWavBlob</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audioBuffer</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>writeString</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>view</span>, <span style=color:#a6e22e>offset</span>, <span style=color:#a6e22e>string</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>string</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;&#34;</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>character</span>, <span style=color:#a6e22e>index</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint8</span>(<span style=color:#a6e22e>offset</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>index</span>, <span style=color:#a6e22e>character</span>.<span style=color:#a6e22e>charCodeAt</span>());
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>samples</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audioBuffer</span>.<span style=color:#a6e22e>getChannelData</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bytesPerSample</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ArrayBuffer</span>(<span style=color:#ae81ff>44</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>samples</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>bytesPerSample</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>view</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DataView</span>(<span style=color:#a6e22e>buffer</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>writeString</span>(<span style=color:#a6e22e>view</span>, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;RIFF&#34;</span>); <span style=color:#75715e>// ChunkID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>36</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>samples</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>bytesPerSample</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// ChunkSize
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>writeString</span>(<span style=color:#a6e22e>view</span>, <span style=color:#ae81ff>8</span>, <span style=color:#e6db74>&#34;WAVE&#34;</span>); <span style=color:#75715e>// Format
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>writeString</span>(<span style=color:#a6e22e>view</span>, <span style=color:#ae81ff>12</span>, <span style=color:#e6db74>&#34;fmt &#34;</span>); <span style=color:#75715e>// Subchunk1ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>16</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// Subchunk1Size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint16</span>(<span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>3</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// AudioFormat (IEEE float)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint16</span>(<span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// NumChannels
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>24</span>, <span style=color:#a6e22e>audioBuffer</span>.<span style=color:#a6e22e>sampleRate</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// SampleRate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>28</span>, <span style=color:#a6e22e>audioBuffer</span>.<span style=color:#a6e22e>sampleRate</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>bytesPerSample</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// ByteRate
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint16</span>(<span style=color:#ae81ff>32</span>, <span style=color:#a6e22e>bytesPerSample</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// BlockAlign
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint16</span>(<span style=color:#ae81ff>34</span>, <span style=color:#ae81ff>32</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// BitsPerSample
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>writeString</span>(<span style=color:#a6e22e>view</span>, <span style=color:#ae81ff>36</span>, <span style=color:#e6db74>&#34;data&#34;</span>); <span style=color:#75715e>// Subchunk2ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setUint32</span>(<span style=color:#ae81ff>40</span>, <span style=color:#a6e22e>samples</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>bytesPerSample</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// Subchunk2Size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>samples</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>sample</span>, <span style=color:#a6e22e>index</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>view</span>.<span style=color:#a6e22e>setFloat32</span>(<span style=color:#ae81ff>44</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>bytesPerSample</span>, <span style=color:#a6e22e>sample</span>, <span style=color:#66d9ef>true</span>); <span style=color:#75715e>// Data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Blob</span>([<span style=color:#a6e22e>view</span>], { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;audio/wav&#34;</span> });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Finally, I added the ability to automatically download the generated WAV blob as a named file within the browser.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>NokiaComposer</span>({ <span style=color:#a6e22e>melodies</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleDownload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>e</span> =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>blob</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>generateWavBlob</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>generateAudioBuffer</span>(<span style=color:#a6e22e>composition</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>autoDownloadLink</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>autoDownloadLink</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>createObjectURL</span>(<span style=color:#a6e22e>blob</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>autoDownloadLink</span>.<span style=color:#a6e22e>download</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>composition</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;:&#34;</span>)[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>autoDownloadLink</span>.<span style=color:#a6e22e>click</span>();
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ..
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>To conclude, I enjoyed exploring how Nokia ringtones were represented in RTTTL, and how you could use a little bit of music theory and maths to generate the corresponding frequencies.
The Web Audio API&rsquo;s <code>AudioContext</code>/<code>Oscillator</code> abstracted away many of the intricacies required to produce the desired sounds.
This allowed me to play the sound in real-time as well as produce an in-memory representation from which I could generate a WAV file.
I found the most interesting part of the exercise was researching how a WAV file is constructed at a raw bits/bytes level.</p></main><footer class=post-footer><ul class="tags tags--large"><li><a href=/archive/tag/javascript>javascript</a></li><li><a href=/archive/tag/web-audio>web-audio</a></li></ul><div class=related><h3 class=related__title>Related Posts</h3><ul class=related__posts><li><a href=/posts/creating-a-contact-tracing-scanner-using-web-bluetooth/>Creating a Contact Tracing Scanner using Web Bluetooth</a></li><li><a href=/posts/building-a-flag-guessing-game-using-react-hooks/>Building a Flag Guessing Game using React Hooks</a></li><li><a href=/posts/mince-pie-challenge-viewing-and-removing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Viewing and Removing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/mince-pie-challenge-adding-and-listing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Adding and Listing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/building-a-babel-plugin-adding-a-function-composition-operator-and-auto-curried-functions-to-javascript/>Building a Babel Plugin: Adding a Function Composition Operator and Auto-Curried Functions to JavaScript</a></li></ul></div></footer></article><div class=scroll-watcher></div></main><footer class="site-footer l-wrapper"><div>&copy; 2025, Edd Mann</div><button class=site-footer__theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>