<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Creating a Time-lapse Camera with HypriotOS/Docker using a Raspberry Pi 3B+ and Raspberry Pi Zero W - Edd Mann</title>
<meta name=description content="Learn how to create a time-lapse camera using HypriotOS, Docker and Raspberry Pi devices. Discover step-by-step instructions and tips for building your own time-lapse camera."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Creating a Time-lapse Camera with HypriotOS/Docker using a Raspberry Pi 3B+ and Raspberry Pi Zero W"><meta itemprop=description content="I have recently started a project that requires the ability to create a time-lapse video over a set duration. Looking at all the possible ways of achieving this, I felt that a Raspberry Pi would be well suited for the job. In this post, I will discuss how I went about setting up both a Raspberry Pi 3 Model B+ and a Raspberry Pi Zero W with HypriotOS to run a Docker-based time-lapse camera Node application."><meta itemprop=datePublished content="2019-02-16T00:00:00+00:00"><meta itemprop=dateModified content="2019-02-16T00:00:00+00:00"><meta itemprop=wordCount content="939"><meta itemprop=keywords content="Raspberry-Pi,Docker"><meta property="og:url" content="https://eddmann.com/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Creating a Time-lapse Camera with HypriotOS/Docker using a Raspberry Pi 3B+ and Raspberry Pi Zero W"><meta property="og:description" content="I have recently started a project that requires the ability to create a time-lapse video over a set duration. Looking at all the possible ways of achieving this, I felt that a Raspberry Pi would be well suited for the job. In this post, I will discuss how I went about setting up both a Raspberry Pi 3 Model B+ and a Raspberry Pi Zero W with HypriotOS to run a Docker-based time-lapse camera Node application."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-16T00:00:00+00:00"><meta property="article:modified_time" content="2019-02-16T00:00:00+00:00"><meta property="article:tag" content="Raspberry-Pi"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating a Time-lapse Camera with HypriotOS/Docker using a Raspberry Pi 3B+ and Raspberry Pi Zero W"><meta name=twitter:description content="I have recently started a project that requires the ability to create a time-lapse video over a set duration. Looking at all the possible ways of achieving this, I felt that a Raspberry Pi would be well suited for the job. In this post, I will discuss how I went about setting up both a Raspberry Pi 3 Model B+ and a Raspberry Pi Zero W with HypriotOS to run a Docker-based time-lapse camera Node application."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.020af028a86e4141eddb604604567804a169da6a588b326f18d39cd2db3b5eb4.css integrity="sha256-AgrwKKhuQUHt22BGBFZ4BKFp2mpYizJvGNOc0ts7XrQ="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/><script>(function(){document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")})()</script><script src=/script.min.1052707861642a4eb63c758a2c16cbf5deb3b3ea2582f09f743a7d4c55fb9828.js integrity="sha256-EFJweGFkKk62PHWKLBbL9d6zs+olgvCfdDp9TFX7mCg=" defer></script></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1 class=transition-between-pages style=--id:creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w>Creating a Time-lapse Camera with HypriotOS/Docker using a Raspberry Pi 3B+ and Raspberry Pi Zero W</h1><time datetime=2019-02-16T00:00:00Z class=post__time>Feb 16, 2019</time></header><main class=prose><p>I have recently started a project that requires the ability to create a time-lapse video over a set duration.
Looking at all the possible ways of achieving this, I felt that a Raspberry Pi would be well suited for the job.
In this post, I will discuss how I went about setting up both a <a href=https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/ rel="external noopener" target=_blank>Raspberry Pi 3 Model B+</a> and a <a href=https://www.raspberrypi.org/products/raspberry-pi-zero-w/ rel="external noopener" target=_blank>Raspberry Pi Zero W</a> with <a href=https://blog.hypriot.com/ rel="external noopener" target=_blank>HypriotOS</a> to run a Docker-based time-lapse camera Node application.</p><p>The decision to run the Node application within Docker provides me with the best flexibility for updating and adding further functionality to the devices at a later date.</p><h2 id=the-setup>The Setup</h2><p>I decided on using both a Raspberry Pi 3 Model B+ and a Raspberry Pi Zero W in order to experiment with the two different form factors.
I wanted to see how well each would perform with the given workload.
Both Pis allow you to connect the Raspberry Pi Camera Module v2 so that you can control how and when a photo is taken.</p><ul><li><a href=https://www.amazon.co.uk/Raspberry-Pi-Model-64-Bit-Processor/dp/B07BDR5PDW rel="external noopener" target=_blank>Raspberry Pi 3 Model B+</a></li><li><a href=https://www.amazon.co.uk/Pi-Blox-Raspberry-Model-Camera-Black/dp/B017Z32E8A/ rel="external noopener" target=_blank>Pi-Blox Case for Raspberry Pi 3</a></li><li><a href=https://www.amazon.co.uk/Raspberry-Pi-1080p-Camera-Module/dp/B01ER2SKFS/ rel="external noopener" target=_blank>Raspberry Pi Camera Module v2.1</a></li></ul><p><picture><source type=image/webp srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_9b053001d7f651a4.webp 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_5de20a5a38bcf4e5.webp 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_4ab3fec62e7469d1.webp 1024w"><source type=image/jpeg srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_4b2b45d2b58c3a77.jpg 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_99263478a2e9781d.jpg 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_1d554df993beb167.jpg 1024w"><img src=/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b_hu_99263478a2e9781d.jpg alt="Raspberry Pi 3 Model B+" loading=lazy>
</picture><picture><source type=image/webp srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_221c3de8db3957ca.webp 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_4923e9f7a33bb829.webp 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_f2073ce4c0c47af8.webp 1024w"><source type=image/jpeg srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_80323ca53a46951e.jpg 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_47db59f6da7e1109.jpg 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_9d1c2d10b6dbfafd.jpg 1024w"><img src=/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi3b-built_hu_47db59f6da7e1109.jpg alt="Built Raspberry Pi 3 Model B+" loading=lazy></picture></p><ul><li><a href=https://www.amazon.co.uk/Raspberry-Pi-Zero-Starter-Kit/dp/B072LWBL37/ rel="external noopener" target=_blank>Raspberry Pi Zero W Starter Kit (inc. Case)</a></li><li><a href=https://www.amazon.co.uk/Raspberry-Pi-1080p-Camera-Module/dp/B01ER2SKFS/ rel="external noopener" target=_blank>Raspberry Pi Camera Module v2.1</a></li></ul><p><picture><source type=image/webp srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_9058e34012278689.webp 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_d4f90058adf583d0.webp 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_a617ff86c9642cc9.webp 1024w"><source type=image/jpeg srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_d725d9bee974e0ef.jpg 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_9b82d52826dce767.jpg 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_917b412c157d54ce.jpg 1024w"><img src=/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero_hu_9b82d52826dce767.jpg alt="Raspberry Pi Zero W" loading=lazy>
</picture><picture><source type=image/webp srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_f8229f909876cc6.webp 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_8e3da49e1c85fd94.webp 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_d1da109f3b0abf2e.webp 1024w"><source type=image/jpeg srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_ade5f49f7ade5e39.jpg 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_4cc27f55a296fe65.jpg 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_47af4c777f64c044.jpg 1024w"><img src=/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pizero-built_hu_4cc27f55a296fe65.jpg alt="Built Raspberry Pi Zero W" loading=lazy></picture></p><h2 id=building-the-node-application>Building the Node Application</h2><p>Now that I had decided on the equipment I was going to use, the next task was to create the <a href=https://github.com/eddmann/pi-timelapse/blob/master/timelapse.js rel="external noopener" target=_blank><code>timelapse.js</code></a> Node application.
The application is a simple script which uses <code>setInterval</code> to block and call the given <code>shoot</code> function with the desired delay.
Photos are organised into a deterministic <code>/year/month/day/hour/</code> directory structure, and each photo follows a <code>year_month_day_hour_minutes_seconds.jpg</code> naming convention.
The actual act of taking the photo (with the desired options) is delegated to the <a href=https://www.raspberrypi.org/documentation/usage/camera/raspicam/raspistill.md rel="external noopener" target=_blank><code>raspistill</code></a> command-line tool provided by the Raspberry Pi organisation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>mkdirSync</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>execSync</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;child_process&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toMilliseconds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>seconds</span> =&gt; <span style=color:#a6e22e>seconds</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getCurrentDate</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pad</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>number</span> =&gt; <span style=color:#a6e22e>number</span>.<span style=color:#a6e22e>toString</span>().<span style=color:#a6e22e>padStart</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>year</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getFullYear</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>month</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pad</span>(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getMonth</span>() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>day</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pad</span>(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getDate</span>()),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hours</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pad</span>(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getHours</span>()),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>minutes</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pad</span>(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getMinutes</span>()),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>seconds</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pad</span>(<span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>getSeconds</span>()),
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getDirectoryPath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>year</span>, <span style=color:#a6e22e>month</span>, <span style=color:#a6e22e>day</span>, <span style=color:#a6e22e>hours</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCurrentDate</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>year</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>month</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>day</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>hours</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getFileName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>year</span>, <span style=color:#a6e22e>month</span>, <span style=color:#a6e22e>day</span>, <span style=color:#a6e22e>hours</span>, <span style=color:#a6e22e>minutes</span>, <span style=color:#a6e22e>seconds</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCurrentDate</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>year</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>month</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>day</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>hours</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>minutes</span><span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>seconds</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.jpg`</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>shoot</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>basePath</span>, <span style=color:#a6e22e>options</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>directory</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getDirectoryPath</span>(<span style=color:#a6e22e>basePath</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mkdirSync</span>(<span style=color:#a6e22e>directory</span>, { <span style=color:#a6e22e>recursive</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getFileName</span>(<span style=color:#a6e22e>directory</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>output</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>execSync</span>(<span style=color:#e6db74>`/opt/vc/bin/raspistill </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>options</span><span style=color:#e6db74>}</span><span style=color:#e6db74> -o </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>file</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>file</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>delay</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>TIME_DELAY</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>basePath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>BASE_PATH</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;/var/photos&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>OPTIONS</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Delay: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>delay</span><span style=color:#e6db74>}</span><span style=color:#e6db74>s, Path: &#39;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>basePath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;, Options: &#39;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>options</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>setInterval</span>(<span style=color:#a6e22e>shoot</span>, <span style=color:#a6e22e>toMilliseconds</span>(<span style=color:#a6e22e>delay</span>), <span style=color:#a6e22e>basePath</span>, <span style=color:#a6e22e>options</span>);
</span></span></code></pre></div><p>This script was then packaged into a Docker image using the following <a href=https://github.com/eddmann/pi-timelapse/blob/master/Dockerfile rel="external noopener" target=_blank><code>Dockerfile</code></a> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> balenalib/raspberry-pi-debian-node:11.3.0-stretch-run</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update -y <span style=color:#f92672>&amp;&amp;</span> apt-get install libraspberrypi-bin -y<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> timelapse.js /var/timelapse.js<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>VOLUME</span><span style=color:#e6db74> /var/photos</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;/var/timelapse.js&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The image ensures that the <a href=https://github.com/raspberrypi/userland rel="external noopener" target=_blank>user-land</a> Raspberry Pi libraries are available (giving us access to <code>raspistill</code>) and provides us with a volume we can mount to our host OS, so as to persist photos taken regardless of the current container instance going away.</p><p>With these two files in place, I was now able to build and push the image to <a href=https://hub.docker.com/r/eddmann/pi-timelapse rel="external noopener" target=_blank>Docker Hub</a> for later use on the Raspberry Pis.</p><h2 id=building-the-hypriotos-image>Building the HypriotOS Image</h2><p>The <a href=https://github.com/hypriot rel="external noopener" target=_blank>Hypriot</a> project takes a lot of the pain out of getting set up with using Docker on the Raspberry Pi and its ARM architecture.
It also includes the <a href=https://cloudinit.readthedocs.io/en/latest/ rel="external noopener" target=_blank>cloud-init</a> library which allows you to clearly define how you wish the instance to be provisioned on first boot.</p><p>In regards to the two time-lapse devices, I used the following cloud-config, specified in <a href=https://github.com/eddmann/pi-timelapse/blob/master/hypriot/user-data.yml rel="external noopener" target=_blank><code>user-data.yml</code></a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e>#cloud-config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>timelapse</span>
</span></span><span style=display:flex><span><span style=color:#f92672>manage_etc_hosts</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>users</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gecos</span>: <span style=color:#e6db74>&#39;Raspberry Pi&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sudo</span>: <span style=color:#ae81ff>ALL=(ALL) NOPASSWD:ALL</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>shell</span>: <span style=color:#ae81ff>/bin/bash</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groups</span>: <span style=color:#ae81ff>users,docker,video</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>plain_text_passwd</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lock_passwd</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssh_pwauth</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>chpasswd</span>: { <span style=color:#f92672>expire</span>: <span style=color:#66d9ef>false</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>locale</span>: <span style=color:#e6db74>&#39;en_US.UTF-8&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>timezone</span>: <span style=color:#e6db74>&#39;Europe/London&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>write_files</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>content</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      allow-hotplug wlan0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      iface wlan0 inet dhcp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      iface default inet dhcp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/network/interfaces.d/wlan0</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>content</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      country=GB
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      update_config=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      network={
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ssid=&#34;ssid&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        psk=&#34;password&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        proto=RSN
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        key_mgmt=WPA-PSK
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        pairwise=CCMP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        auth_alg=OPEN
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/etc/wpa_supplicant/wpa_supplicant.conf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>runcmd</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#39;systemctl restart avahi-daemon&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#39;ifup wlan0&#39;</span>
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#39;mkdir -p /home/pi/photos&#39;</span>
</span></span><span style=display:flex><span>  - [
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>docker, run,</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;-d&#34;</span>, <span style=color:#e6db74>&#34;--privileged&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--restart&#34;</span>, <span style=color:#e6db74>&#34;always&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--volume&#34;</span>, <span style=color:#e6db74>&#34;/home/pi/photos:/var/photos&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--name&#34;</span>, <span style=color:#e6db74>&#34;timelapse&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--env&#34;</span>, <span style=color:#e6db74>&#34;TIME_DELAY=30&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;--env&#34;</span>, <span style=color:#e6db74>&#39;OPTIONS=&#34;&#34;&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;eddmann/pi-timelapse&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span></code></pre></div><p>This provisions the given instance with the desired user account, WiFi access and starts the Docker container instance with the provided options.
As well as this definition, I was also required to ensure that the camera module was enabled.
To do this, I created a <a href=https://github.com/eddmann/pi-timelapse/blob/master/hypriot/boot-config.txt rel="external noopener" target=_blank><code>boot-config.txt</code></a> file as follows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>hdmi_force_hotplug</span><span style=color:#f92672>=</span><span style=color:#e6db74>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>enable_uart</span><span style=color:#f92672>=</span><span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># camera settings, see http://elinux.org/RPiconfig#Camera</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>start_x</span><span style=color:#f92672>=</span><span style=color:#e6db74>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>disable_camera_led</span><span style=color:#f92672>=</span><span style=color:#e6db74>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>gpu_mem</span><span style=color:#f92672>=</span><span style=color:#e6db74>128</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Enable audio (added by raspberrypi-sys-mods)</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dtparam</span><span style=color:#f92672>=</span><span style=color:#e6db74>audio=on</span>
</span></span></code></pre></div><p>With these two files now defined, I was able to use the <a href=https://github.com/hypriot/flash rel="external noopener" target=_blank>flash script</a> provided by Hypriot to easily write the given image to two separate MicroSD cards.
The only varying factor per image was the desired hostname, and as such I was able to supply this whilst invoking the flash script.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>flash <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --hostname timelapse <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --userdata user-data.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --bootconf boot-config.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  https://github.com/hypriot/image-builder-rpi/releases/download/v1.10.0-rc2/hypriotos-rpi-v1.10.0-rc2.img.zip
</span></span></code></pre></div><p>With both the Docker and Raspberry Pi HypriotOS images now written, I was able to move on to actually experimenting with the devices. ðŸ“¸</p><h2 id=booting-the-raspberry-pi-time-lapse-camera>Booting the Raspberry Pi Time-lapse Camera</h2><p>After inserting MicroSD cards into each Raspberry Pi, I was able to access both devices via SSH using the chosen hostnames (i.e. <code>timelapse.local</code>).
The Docker container had been successfully configured to start at boot time and would restart automatically in the event of any errors.</p><p><picture><source type=image/webp srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_ac63ba616ceb4ae6.webp 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_321a35b045e9b57b.webp 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_41a182837daf52df.webp 1024w"><source type=image/jpeg srcset="/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_2ba9bf99a5569752.jpg 350w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_6af2055d7310496c.jpg 700w, /posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_e4b2f73df3721b20.jpg 1024w"><img src=/posts/creating-a-time-lapse-camera-with-hypriotos-docker-using-a-raspberry-pi-3b-plus-and-raspberry-pi-zero-w/pi-built_hu_6af2055d7310496c.jpg alt="Complete Raspberry Pi Builds" loading=lazy></picture></p><p>The only step now is to wait for the time-lapse to complete, and then finally I can stitch the images together using some simple video editing software.</p></main><footer class=post__tags><a href=/archive/tag/raspberry-pi>raspberry-pi</a><a href=/archive/tag/docker>docker</a></footer></article><div class="related-posts prose"><h3>Related Posts</h3><ul><li><a href=/posts/compiling-pokered-using-docker-and-adding-super-b-button-behaviour/>Compiling PokÃ©mon Red (pokered) using Docker and adding 'Super B' button behaviour</a></li><li><a href=/posts/creating-a-command-line-application-to-fetch-url-titles-in-go/>Creating a Command Line Application to Fetch URL Titles in Go</a></li><li><a href=/posts/mince-pie-challenge-setting-up-the-serverless-framework-with-docker-webpack-and-babel/>Mince Pie Challenge: Setting up the Serverless Framework with Docker, Webpack and Babel</a></li></ul></div><div class=scroll-watcher></div></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div><button class=theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>