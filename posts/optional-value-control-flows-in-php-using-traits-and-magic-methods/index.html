<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Optional Value Control-flows in PHP using Traits and Magic-methods - Edd Mann</title>
<meta name=description content="Discover elegant techniques to handle optional values in PHP using traits, magic methods, and composition to streamline control flows and reduce boilerplate code."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Optional Value Control-flows in PHP using Traits and Magic-methods"><meta itemprop=description content="Recently, I have been interested in experimenting with different ways to handle optional values. There are many examples that exist demonstrating the use of the Maybe/Optional structure within the PHP landscape. I would instead like to focus my attention on only looking into the concept of orElse, which I have found to be a prominent control-flow when using these types of values."><meta itemprop=datePublished content="2015-06-10T00:00:00+00:00"><meta itemprop=dateModified content="2015-06-10T00:00:00+00:00"><meta itemprop=wordCount content="774"><meta itemprop=keywords content="Php"><meta property="og:url" content="https://eddmann.com/posts/optional-value-control-flows-in-php-using-traits-and-magic-methods/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Optional Value Control-flows in PHP using Traits and Magic-methods"><meta property="og:description" content="Recently, I have been interested in experimenting with different ways to handle optional values. There are many examples that exist demonstrating the use of the Maybe/Optional structure within the PHP landscape. I would instead like to focus my attention on only looking into the concept of orElse, which I have found to be a prominent control-flow when using these types of values."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-06-10T00:00:00+00:00"><meta property="article:modified_time" content="2015-06-10T00:00:00+00:00"><meta property="article:tag" content="Php"><meta name=twitter:card content="summary"><meta name=twitter:title content="Optional Value Control-flows in PHP using Traits and Magic-methods"><meta name=twitter:description content="Recently, I have been interested in experimenting with different ways to handle optional values. There are many examples that exist demonstrating the use of the Maybe/Optional structure within the PHP landscape. I would instead like to focus my attention on only looking into the concept of orElse, which I have found to be a prominent control-flow when using these types of values."><meta name=twitter:site content="@edd_mann"><link rel="preload stylesheet" as=style href=/css/style.min.0121a173d3063b9541f1f561a87125fd59dc1fac6110b21c15bba8bc141b70b1.css integrity="sha256-ASGhc9MGO5VB8fVhqHEl/VncH6xhELIcFbuovBQbcLE="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/optional-value-control-flows-in-php-using-traits-and-magic-methods/></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><div class=site-header__mobile-navigation-button aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></div><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1>Optional Value Control-flows in PHP using Traits and Magic-methods</h1><time class=post__time>Jun 10, 2015</time></header><main class=prose><p>Recently, I have been interested in experimenting with different ways to handle optional values.
There are many examples that exist demonstrating the use of the Maybe/Optional structure within the PHP landscape.
I would instead like to focus my attention on only looking into the concept of <code>orElse</code>, which I have found to be a prominent control-flow when using these types of values.</p><p>Typically, in an imperative mindset we are accustomed to evaluating a value, and based on its existence - defined as falsy in this context - we follow a different course of action.
This can be clearly seen in the following two examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$cart <span style=color:#f92672>=</span> $repository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($cart <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) $cart <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$cart <span style=color:#f92672>=</span> $repository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>(<span style=color:#ae81ff>1</span>) <span style=color:#f92672>?:</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>;
</span></span></code></pre></div><p>These two examples both attempt to fetch a shopping cart from a repository, which, by looking at the defined guards, may not exist.
As a result of this, we are required to write extra boilerplate code to handle the possibility of failure, using either a conditional block with reassignment or the ternary null trick provided within PHP.</p><h2 id=using-traits>Using Traits</h2><p>I was interested to see if there were any other ways of more clearly expressing this intent, following the popular control-flow concept provided within Optional types.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>OrElse</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __call($name, <span style=color:#66d9ef>array</span> $args)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $isOrElse <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/OrElse$/i&#39;</span>, $name) <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>count</span>($args) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($isOrElse) {
</span></span><span style=display:flex><span>            $orElse <span style=color:#f92672>=</span> <span style=color:#a6e22e>array_pop</span>($args);
</span></span><span style=display:flex><span>            $result <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span>{<span style=color:#a6e22e>substr</span>($name, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>)}(<span style=color:#f92672>...</span>$args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ($result <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>is_callable</span>($orElse) <span style=color:#f92672>?</span> $orElse() <span style=color:#f92672>:</span> $orElse;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This trait takes advantage of PHP&rsquo;s dynamic message passing nature, essentially wrapping calls with the boilerplate code typically required.
Any unknown method calls are checked to see if they end in <code>OrElse</code> and include at least one argument.
If this is the case, the last argument is removed from the supplied parameters array and the intended method (excluding <code>OrElse</code>) is invoked with the remaining arguments.
Finally, the boilerplate guard logic that we typically see handling the occurrence of falsy values is encapsulated into this single location.
If a falsy value is returned from the method invocation, the user-defined literal or function value is returned instead.
The code initially described could now be rewritten as follows, assuming that the repository includes the trait in its definition.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$cart <span style=color:#f92672>=</span> $repository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByIdOrElse</span>(<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>);
</span></span><span style=display:flex><span>$cart <span style=color:#f92672>=</span> $repository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByIdOrElse</span>(<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>; });
</span></span></code></pre></div><p>You can see from the examples above how we have been able to be more expressive within the method call, describing its intent more clearly.
This method now reads as one that expects the possibility of a non-existent or alternative return value.
The second example is a rewrite of the first, taking into consideration the fact that all method parameters are interpreted during invocation - resulting in the possibility of a new cart being created but never required.
Instead, the value is wrapped in a function which is lazily called by the trait implementation if needed.</p><h2 id=using-composition>Using Composition</h2><p>If you are against the idea of altering the behaviour of the class by adding a trait - and instead wish to perform such actions ad hoc - the following example shows how the same can be achieved through composition.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrElse</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>use</span> <span style=color:#a6e22e>OrElseTrait</span> { <span style=color:#a6e22e>__call</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>orElseCall</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $object;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($object)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>object</span> <span style=color:#f92672>=</span> $object;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __call($name, <span style=color:#66d9ef>array</span> $args)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>method_exists</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>object</span>, $name)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>object</span><span style=color:#f92672>-&gt;</span>$name(<span style=color:#f92672>...</span>$args);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>orElseCall</span>($name, $args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Using a proxy class, we are able to direct any existing method calls to the supplied object, handling non-existent methods via the <code>OrElse</code> trait.
This implementation can then be used in the following manner.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$orElseRepository <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>OrElse</span>($repository);
</span></span><span style=display:flex><span>$cart <span style=color:#f92672>=</span> $orElseRepository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findByIdOrElse</span>(<span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>);
</span></span></code></pre></div><h2 id=using-basic-functions>Using Basic Functions</h2><p>Finally, a completely different way to control the flow of returned values is by coding up a simple function as follows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>_or</span>(<span style=color:#f92672>...</span>$args)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span> ($args <span style=color:#66d9ef>as</span> $arg) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($result <span style=color:#f92672>=</span> <span style=color:#a6e22e>is_callable</span>($arg) <span style=color:#f92672>?</span> $arg() <span style=color:#f92672>:</span> $arg) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> $result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function simply iterates over all its arguments, evaluating each until one returns a truthy value, which it subsequently returns.
This is by far the least obstructive manner in which to implement such control flow capabilities, but in my opinion does not read as nicely as the above two examples.
This example can be used to achieve the same results as before, using the following approach.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$cart <span style=color:#f92672>=</span> <span style=color:#a6e22e>_or</span>($repository<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>findById</span>(<span style=color:#ae81ff>1</span>), <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ShoppingCart</span>);
</span></span></code></pre></div><p>I hope you have enjoyed this thought experiment into how we can extract and use concepts from different paradigms in our day-to-day code.
Also, it may have sparked some interest in seeing how you can take advantage of PHP Traits along with magic method invocation.</p></main><footer class=post__tags><a href=/archive/tag/php>php</a></footer></article></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div></footer><script>(function(){document.querySelector(".site-header__mobile-navigation-button").addEventListener("click",e=>{document.documentElement.classList.toggle("mobile-navigation-open"),e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")});const n=document.querySelector(".site-header");let t=window.pageYOffset,e=!1;window.addEventListener("scroll",()=>{if(e)return;const s=window.pageYOffset;window.requestAnimationFrame(()=>{n.classList.toggle("is-sticky",t>s),t=s,e=!1}),e=!0})})()</script></body></html>