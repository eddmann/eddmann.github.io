<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Creating a React-based Chess Game with WASM Bots in TypeScript - Edd Mann</title>
<meta name=description content="Learn how to build a React-based chess game integrated with WebAssembly (WASM) bots in TypeScript, utilising React Hooks, the UCI protocol and Yarn 2 features."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Creating a React-based Chess Game with WASM Bots in TypeScript"><meta itemprop=description content="A couple of years ago I explored using a WebAssembly port of Stockfish (the popular Chess engine) as a ‘Bot’ for a small React-based Chess implementation. I decided over the past week to revisit it and rewrite the implementation in TypeScript, along with providing more Bot types to choose from."><meta itemprop=datePublished content="2020-11-11T00:00:00+00:00"><meta itemprop=dateModified content="2020-11-11T00:00:00+00:00"><meta itemprop=wordCount content="1653"><meta itemprop=keywords content="React,Chess,Typescript,Wasm"><meta property="og:url" content="https://eddmann.com/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Creating a React-based Chess Game with WASM Bots in TypeScript"><meta property="og:description" content="A couple of years ago I explored using a WebAssembly port of Stockfish (the popular Chess engine) as a ‘Bot’ for a small React-based Chess implementation. I decided over the past week to revisit it and rewrite the implementation in TypeScript, along with providing more Bot types to choose from."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-11T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-11T00:00:00+00:00"><meta property="article:tag" content="React"><meta property="article:tag" content="Chess"><meta property="article:tag" content="Typescript"><meta property="article:tag" content="Wasm"><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating a React-based Chess Game with WASM Bots in TypeScript"><meta name=twitter:description content="A couple of years ago I explored using a WebAssembly port of Stockfish (the popular Chess engine) as a ‘Bot’ for a small React-based Chess implementation. I decided over the past week to revisit it and rewrite the implementation in TypeScript, along with providing more Bot types to choose from."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.385a4c6910ac4090f8725dd12816e7725e21fbe762a09e31f1ece6d5dfebea36.css integrity="sha256-OFpMaRCsQJD4cl3RKBbncl4h++dioJ4x8ezm1d/r6jY="><link rel=preload as=image href=/assets/x.svg crossorigin=anonymous><link rel=preload as=image href=/assets/github.svg crossorigin=anonymous><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/><script>document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")</script><script src=/script.min.ae6714091b36270ca9f57283d0ac9a419cdcb8a86bf4142c7bf9e5f3de736b86.js integrity="sha256-rmcUCRs2Jwyp9XKD0KyaQZzcuKhr9BQse/nl895za4Y=" defer></script></head><body><header class="site-header l-wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=l-wrapper><article><header class=l-page-title><h1 class=u-transition-between-pages style=--id:creating-a-react-based-chess-game-with-wasm-bots-in-typescript>Creating a React-based Chess Game with WASM Bots in TypeScript</h1><time datetime=2020-11-11T00:00:00Z class=published-at>Nov 11, 2020</time></header><main class=u-prose><p>A couple of years ago I explored using a <a href=https://github.com/niklasf/stockfish.wasm rel="external noopener" target=_blank>WebAssembly port</a> of <a href=https://stockfishchess.org/ rel="external noopener" target=_blank>Stockfish</a> (the popular Chess engine) as a &lsquo;Bot&rsquo; for a small React-based Chess implementation.
I decided over the past week to revisit it and rewrite the implementation in TypeScript, along with providing more Bot types to choose from.</p><p>You can experiment with the final implementation <a href=https://eddmann.com/chessbot-typescript/>here</a>.
The source code is available on <a href=https://github.com/eddmann/chessbot-typescript rel="external noopener" target=_blank>GitHub</a> to review.</p><p><a href=https://eddmann.com/chessbot-typescript/><picture><source type=image/webp srcset="/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_a52c7e7c660f2dd6.webp 350w, /posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_8c271af48b89fed2.webp 700w, /posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_9cb5e9a40ef94b9.webp 1400w"><source type=image/jpeg srcset="/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_e1a9bdc991779ed3.jpg 350w, /posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_743556d323f0b228.jpg 700w, /posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_10e136eaff03df8f.jpg 1400w"><img src=/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/chessbot_hu_743556d323f0b228.jpg alt=Chessbot loading=lazy></picture></a></p><h2 id=the-game-engine>The Game Engine</h2><p>To provide the Chess ruleset I decided to expose a simple wrapper around the popular <a href=https://github.com/jhlywa/chess.js rel="external noopener" target=_blank>jhlywa/chess.js</a> library.
Abstracting away any state present (as the library is class-based) and providing referentially transparent functions meant that I could simplify the client code.
All functions based their decisions on a supplied <a href=https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation rel="external noopener" target=_blank>Forsyth–Edwards Notation</a> (FEN) state of the current game.</p><p>I used a TypeScript type-definition that was provided by DefinitelyTyped for the library but noticed an issue in how it was defining the constructor.
Thanks to <a href=https://yarnpkg.com/cli/patch rel="external noopener" target=_blank>Yarn 2 patches</a> I was able to include a <a href=https://github.com/eddmann/chessbot-typescript/blob/master/%40types-chessjs.diff rel="external noopener" target=_blank>diff</a> within my repository that resolved this issue, until it is fixed upstream.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Chess</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;chess.js&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Square</span>, <span style=color:#a6e22e>Move</span>, <span style=color:#a6e22e>ShortMove</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;chess.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Fen</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GameWinner</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;b&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;w&#39;</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Square</span>, <span style=color:#a6e22e>Move</span>, <span style=color:#a6e22e>ShortMove</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newGame</span> <span style=color:#f92672>=</span> ()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Fen</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isNewGame</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>fen</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>newGame</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isBlackTurn</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>turn</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;b&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isWhiteTurn</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>turn</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;w&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isCheck</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>in_check</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getGameWinner</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>GameWinner</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>game</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>in_checkmate</span>() <span style=color:#f92672>?</span> (<span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>turn</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;w&#39;</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;b&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isGameOver</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>game_over</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isMoveable</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>, <span style=color:#66d9ef>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Square</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>moves</span>({ <span style=color:#a6e22e>square</span>: <span style=color:#66d9ef>from</span> }).<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>move</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>, <span style=color:#66d9ef>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Square</span>, <span style=color:#a6e22e>to</span>: <span style=color:#66d9ef>Square</span>)<span style=color:#f92672>:</span> [<span style=color:#a6e22e>Fen</span>, <span style=color:#a6e22e>Move</span>] <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>game</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>move</span>({ <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span>, <span style=color:#a6e22e>promotion</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;q&#39;</span> });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>action</span> <span style=color:#f92672>?</span> [<span style=color:#a6e22e>game</span>.<span style=color:#a6e22e>fen</span>(), <span style=color:#a6e22e>action</span>] <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Looking at the engine implementation above you can see that, along with some custom-made types, I also leveraged and exposed several types which were provided by the <code>chess.js</code> type-definition.</p><h2 id=the-bots>The Bots</h2><p>With the ability to now determine how a game of Chess is played I could then move on to explore how to model the concept of a Bot.
I opted to define a couple of types up-front which expressed the behavioural intent of how a Bot should be initialised and used.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Fen</span>, <span style=color:#a6e22e>ShortMove</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./engine&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UninitialisedBot</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>InitialisedBot</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>InitialisedBot</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>Fen</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>ShortMove</span>&gt;;
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AvailableBots</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Record</span>&lt;<span style=color:#f92672>string</span>, <span style=color:#a6e22e>UninitialisedBot</span>&gt;;
</span></span></code></pre></div><p>Using these types I was able to implement the first example Bot – that being the trivial Random Bot.
Given a supplied FEN it determines all the available legal moves and then randomly picks one to enact.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>randomMove</span>: <span style=color:#66d9ef>UninitialisedBot</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>fen</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>(<span style=color:#a6e22e>resolve</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>moves</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Chess</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>moves</span>({ <span style=color:#a6e22e>verbose</span>: <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>moves</span>[Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>moves</span>.<span style=color:#a6e22e>length</span>)];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTimeout</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>resolve</span>({ <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span> }), <span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><p>For client-based visual considerations I set a small delay before resolving the Promise.
This gives the impression of the Bot &lsquo;doing work&rsquo; to make the decision.
With this bot now available, I moved on to expressing externally provided Bots.
Using <a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers rel="external noopener" target=_blank>Web Workers</a> and the <a href=https://en.wikipedia.org/wiki/Universal_Chess_Interface rel="external noopener" target=_blank>Universal Chess Interface</a> (UCI) I found it possible to interface with several different JavaScript/WASM-based Chess Bots.
The code executed in the Web Worker was either JavaScript-based in the case of <a href=https://github.com/op12no2/lozza rel="external noopener" target=_blank>op12no2/lozza</a> or WASM-based in the case of the Stockfish-port <a href=https://github.com/nmrugg/stockfish.js/ rel="external noopener" target=_blank>nmrugg/stockfish.js</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>uciWorker</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>file</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>actions</span>: <span style=color:#66d9ef>Array</span>&lt;<span style=color:#f92672>string</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#a6e22e>UninitialisedBot</span> <span style=color:#f92672>=&gt;</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>worker</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Worker</span>(<span style=color:#a6e22e>file</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>resolver</span><span style=color:#f92672>:</span> ((<span style=color:#a6e22e>move</span>: <span style=color:#66d9ef>ShortMove</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>) <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>worker</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;message&#39;</span>, <span style=color:#a6e22e>e</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>move</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^bestmove\s([a-h][1-8])([a-h][1-8])/</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>resolver</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolver</span>({ <span style=color:#66d9ef>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>move</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>to</span>: <span style=color:#66d9ef>move</span>[<span style=color:#ae81ff>2</span>] });
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolver</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fen</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>resolver</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>reject</span>(<span style=color:#e6db74>&#39;Pending move is present&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>resolver</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resolve</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>worker</span>.<span style=color:#a6e22e>postMessage</span>(<span style=color:#e6db74>`position fen </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>fen</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>actions</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>action</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>worker</span>.<span style=color:#a6e22e>postMessage</span>(<span style=color:#a6e22e>action</span>));
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Providing the above abstraction allowed me to define many different external Bots and configurations (levels and depths).
It also paves the way for extension to any other Bot that supports the UCI protocol in the future.
Converting the Web Worker message-based system into a Promise was an interesting exercise.
Harnessing the power of closures, I needed to keep a reference to the current <code>resolve</code> function.
Upon the <code>bestmove</code> Bot response I could then resolve the given Promise.</p><p>Finally, these Bots could be exposed for use within the React Chess implementation like so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Bots</span>: <span style=color:#66d9ef>AvailableBots</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Random</span>: <span style=color:#66d9ef>randomMove</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nmrugg/stockfish (l:1,d:10)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/stockfish.js-10.0.2/stockfish.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go depth 10&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nmrugg/stockfish (l:20,d:10)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/stockfish.js-10.0.2/stockfish.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 20&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go depth 10&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;nmrugg/stockfish (l:20,t:1s)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/stockfish.js-10.0.2/stockfish.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 20&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go movetime 1000&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;op12no2/lozza (l:1,d:10)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/lozza-1.18/lozza.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 1&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go depth 10&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;op12no2/lozza (l:20,d:10)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/lozza-1.18/lozza.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 20&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go depth 10&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;op12no2/lozza (l:20,t:1s)&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>uciWorker</span>(<span style=color:#e6db74>&#39;bots/lozza-1.18/lozza.js&#39;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;setoption name Skill Level value 20&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;go movetime 1000&#39;</span>,
</span></span><span style=display:flex><span>  ]),
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=the-react-interface>The React Interface</h2><p>The game interface itself leverages the <a href=https://github.com/willb335/chessboardjsx rel="external noopener" target=_blank>willb335/chessboardjsx</a> React component to provide the Chessboard implementation.
I also use a typed <a href=https://create-react-app.dev/docs/adding-a-css-modules-stylesheet/ rel="external noopener" target=_blank>CSS Modules Stylesheet</a> to cleanly separate out the desired client-side styling concerns.
The user is able to specify whether each player is user-based or Bot-based, and if Bot-based which configuration they would like to use.</p><p>The <code>BotSelector</code> below provides a simple component which achieves this goal.
Upon selection an initialised Bot is passed back to the parent component via a <code>setSelectedBot</code> function invocation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BotSelector</span>: <span style=color:#66d9ef>React.FC</span><span style=color:#f92672>&lt;</span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>playerName</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availableBots</span>: <span style=color:#66d9ef>AvailableBots</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selectedBot</span>: <span style=color:#66d9ef>SelectedBot</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setSelectedBot</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>bot</span>: <span style=color:#66d9ef>SelectedBot</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>disabled</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>}<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>playerName</span>, <span style=color:#a6e22e>availableBots</span>, <span style=color:#a6e22e>selectedBot</span>, <span style=color:#a6e22e>setSelectedBot</span>, <span style=color:#a6e22e>disabled</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleChange</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>: <span style=color:#66d9ef>ChangeEvent</span>&lt;<span style=color:#f92672>HTMLSelectElement</span>&gt;)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setSelectedBot</span>(<span style=color:#a6e22e>name</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>move</span>: <span style=color:#66d9ef>availableBots</span>[<span style=color:#a6e22e>name</span>]() } <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>BotSelector</span>}&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>label</span>&gt;{<span style=color:#a6e22e>playerName</span>}&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>select</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>selectedBot</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>name</span>} <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>handleChange</span>} <span style=color:#a6e22e>disabled</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>disabled</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>option</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;User&#34;</span>&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>option</span>&gt;
</span></span><span style=display:flex><span>        {Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>availableBots</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>name</span> <span style=color:#f92672>=&gt;</span> (
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>option</span> <span style=color:#a6e22e>key</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>name</span>}&gt;{<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>option</span>&gt;
</span></span><span style=display:flex><span>        ))}
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>select</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>So as to recount the game&rsquo;s previous moves, I also provided the concept of a <code>History</code> listing.
This includes all the previous moves in <a href=https://en.wikipedia.org/wiki/Portable_Game_Notation rel="external noopener" target=_blank>Portable Game Notation</a> (PGN) form.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>History</span>: <span style=color:#66d9ef>React.FC</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>history</span>: <span style=color:#66d9ef>Array</span>&lt;<span style=color:#f92672>engine.Move</span>&gt; }<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>history</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>endRef</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRef</span>&lt;<span style=color:#f92672>HTMLDivElement</span>&gt;(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>useEffect</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endRef</span>.<span style=color:#a6e22e>current</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>scrollIntoView</span>();
</span></span><span style=display:flex><span>  }, [<span style=color:#a6e22e>history</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>pre</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>History</span>}&gt;
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>history</span>.<span style=color:#a6e22e>map</span>(({ <span style=color:#a6e22e>color</span>, <span style=color:#a6e22e>piece</span>, <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>san</span> }) <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>color</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>piece</span><span style=color:#e6db74>}${</span><span style=color:#66d9ef>from</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>san</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>).<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)}
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>ref</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>endRef</span>} /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>pre</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Using an empty <code>div</code> HTML reference I was able to ensure that the listing was pinned to the bottom at all times.
The provided effect ensured that we only attempted to interact with the DOM and scroll the HTML element when the supplied history had changed.</p><p>Finally, we could incorporate these two components into the React interface itself.
Storing the game state and Bot selection choices in this manner allowed me to harness a single effect to invoke any Bot moves and to determine if the game had completed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>App</span>: <span style=color:#66d9ef>React.FC</span><span style=color:#f92672>&lt;</span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bots</span>: <span style=color:#66d9ef>AvailableBots</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onGameCompleted</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>winner</span>: <span style=color:#66d9ef>engine.GameWinner</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>;
</span></span><span style=display:flex><span>}<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>bots</span>, <span style=color:#a6e22e>onGameCompleted</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>isPlaying</span>, <span style=color:#a6e22e>setPlaying</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>boolean</span>&gt;(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>fen</span>, <span style=color:#a6e22e>setFen</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>engine.Fen</span>&gt;(<span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>newGame</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>history</span>, <span style=color:#a6e22e>setHistory</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>Array</span>&lt;<span style=color:#f92672>engine.Move</span>&gt;&gt;([]);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>whiteBot</span>, <span style=color:#a6e22e>setWhiteBot</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>SelectedBot</span>&gt;(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>blackBot</span>, <span style=color:#a6e22e>setBlackBot</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>SelectedBot</span>&gt;(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newGame</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setPlaying</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setFen</span>(<span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>newGame</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setHistory</span>([]);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>doMove</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useCallback</span>(
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>fen</span>: <span style=color:#66d9ef>engine.Fen</span>, <span style=color:#66d9ef>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>Square</span>, <span style=color:#a6e22e>to</span>: <span style=color:#66d9ef>engine.Square</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>move</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>fen</span>, <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>move</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>newFen</span>, <span style=color:#a6e22e>action</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>move</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isGameOver</span>(<span style=color:#a6e22e>newFen</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onGameCompleted</span>(<span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>getGameWinner</span>(<span style=color:#a6e22e>newFen</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>newGame</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setFen</span>(<span style=color:#a6e22e>newFen</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setHistory</span>(<span style=color:#a6e22e>history</span> <span style=color:#f92672>=&gt;</span> [...<span style=color:#a6e22e>history</span>, <span style=color:#a6e22e>action</span>]);
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    [<span style=color:#a6e22e>onGameCompleted</span>]
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>onDragStart</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>sourceSquare</span>: <span style=color:#66d9ef>from</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>Pick</span>&lt;<span style=color:#f92672>BoardMove</span>, <span style=color:#e6db74>&#39;sourceSquare&#39;</span>&gt;) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isWhiteBotTurn</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>whiteBot</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isWhiteTurn</span>(<span style=color:#a6e22e>fen</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isBlackBotTurn</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>blackBot</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isBlackTurn</span>(<span style=color:#a6e22e>fen</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>isPlaying</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isMoveable</span>(<span style=color:#a6e22e>fen</span>, <span style=color:#66d9ef>from</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>(<span style=color:#a6e22e>isWhiteBotTurn</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>isBlackBotTurn</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>onMovePiece</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>sourceSquare</span>: <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>targetSquare</span>: <span style=color:#66d9ef>to</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>BoardMove</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>doMove</span>(<span style=color:#a6e22e>fen</span>, <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>useEffect</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isPlaying</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isBotMovePlayable</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>whiteBot</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isWhiteTurn</span>(<span style=color:#a6e22e>fen</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>whiteBot</span>.<span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>then</span>(({ <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>ShortMove</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isBotMovePlayable</span>) <span style=color:#a6e22e>doMove</span>(<span style=color:#a6e22e>fen</span>, <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>blackBot</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>isBlackTurn</span>(<span style=color:#a6e22e>fen</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>blackBot</span>.<span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>fen</span>).<span style=color:#a6e22e>then</span>(({ <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>engine</span>.<span style=color:#a6e22e>ShortMove</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isBotMovePlayable</span>) <span style=color:#a6e22e>doMove</span>(<span style=color:#a6e22e>fen</span>, <span style=color:#66d9ef>from</span>, <span style=color:#a6e22e>to</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>isBotMovePlayable</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }, [<span style=color:#a6e22e>isPlaying</span>, <span style=color:#a6e22e>fen</span>, <span style=color:#a6e22e>whiteBot</span>, <span style=color:#a6e22e>blackBot</span>, <span style=color:#a6e22e>doMove</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>App</span>}&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>header</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#960050;background-color:#1e0010>♛</span> <span style=color:#a6e22e>Chessbot</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>header</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>TopNav</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>BotSelector</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>playerName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;White&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>availableBots</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>bots</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>selectedBot</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>whiteBot</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>setSelectedBot</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>setWhiteBot</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>disabled</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>isPlaying</span>}
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>BotSelector</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>playerName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Black&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>availableBots</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>bots</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>selectedBot</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>blackBot</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>setSelectedBot</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>setBlackBot</span>}
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>disabled</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>isPlaying</span>}
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>Button</span>} <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>setPlaying</span>(<span style=color:#a6e22e>playing</span> <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>playing</span>)}&gt;
</span></span><span style=display:flex><span>          {<span style=color:#a6e22e>isPlaying</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Pause&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Play&#39;</span>}
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>Button</span>} <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>newGame</span>}&gt;
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Reset</span>
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>Chessboard</span>}&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Chessboard</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>fen</span>} <span style=color:#a6e22e>allowDrag</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onDragStart</span>} <span style=color:#a6e22e>onDrop</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onMovePiece</span>} /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>History</span> <span style=color:#a6e22e>history</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>history</span>} /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Wrapping the <code>doMove</code> in a Callback hook ensured that the game effect was not needlessly invoked upon render unless the game state or <code>onGameCompleted</code> callback had changed.
I also provided some clean-up in the way that if the game had changed in-between requesting a Bot move, we would discard the previous move, thus ensuring that the game maintained a valid state.</p><h2 id=conclusion>Conclusion</h2><p>I found this small project to be a very valuable exercise in exploring what is possible using TypeScript and React Hooks.
It also provided me with a good opportunity to explore Yarn 2 and <a href=https://yarnpkg.com/features/zero-installs rel="external noopener" target=_blank>Zero-installs</a>.
I enjoyed creating the abstraction around the concept of a UCI-based Bot, paving the way for additional Bots to be added in the future.</p><p>Going forward it would be interesting to explore providing more than just the current FEN chess state to the given Bot.
At this time I am treating all Bots as stateless.
It would be good to explore making them aware of historical moves, as this would help aid in their decision making and prevent them from attempting repeated moves over a certain threshold.</p><p>Happy Chess Playing!</p><p><a href=https://eddmann.com/chessbot-typescript/><img src=/posts/creating-a-react-based-chess-game-with-wasm-bots-in-typescript/example-game.gif alt="Example Game" loading=lazy></a></p></main><footer class=post-footer><ul class="tags tags--large"><li><a href=/archive/tag/react>react</a></li><li><a href=/archive/tag/chess>chess</a></li><li><a href=/archive/tag/typescript>typescript</a></li><li><a href=/archive/tag/wasm>wasm</a></li></ul><div class=related><h3 class=related__title>Related Posts</h3><ul class=related__posts><li><a href=/posts/binary-addition-using-half-and-full-adders-within-typescript/>Binary Addition using Half and Full Adders within TypeScript</a></li><li><a href=/posts/building-a-flag-guessing-game-using-react-hooks/>Building a Flag Guessing Game using React Hooks</a></li><li><a href=/posts/mince-pie-challenge-building-a-serverless-restful-api-and-react-client/>Mince Pie Challenge: Building a Serverless RESTful API and React Client</a></li><li><a href=/posts/handling-time-dependent-state-recording-using-react/>Handling Time-Dependent State Recording using React</a></li><li><a href=/posts/asynchronous-calls-within-flux/>Asynchronous Calls within Flux</a></li></ul></div></footer></article><div class=scroll-watcher></div></main><footer class="site-footer l-wrapper"><div>&copy; 2025, Edd Mann</div><button class=site-footer__theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>