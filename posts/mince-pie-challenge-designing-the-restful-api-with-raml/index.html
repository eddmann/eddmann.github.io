<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Mince Pie Challenge: Designing the RESTful API with RAML - Edd Mann</title>
<meta name=description content="Learn how to design a RESTful API using RAML for the Mince Pie Challenge with detailed guidelines, best practices and authentication strategies."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Mince Pie Challenge: Designing the RESTful API with RAML"><meta itemprop=description content="Now that we are aware of what needs to be done, we can go about designing the RESTful API that will be used to process and persist those vital mince pies."><meta itemprop=datePublished content="2018-06-11T00:00:00+00:00"><meta itemprop=dateModified content="2018-06-11T00:00:00+00:00"><meta itemprop=wordCount content="1734"><meta itemprop=keywords content="Rest,Raml,Mince-Pie-Challenge-Series"><meta property="og:url" content="https://eddmann.com/posts/mince-pie-challenge-designing-the-restful-api-with-raml/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Mince Pie Challenge: Designing the RESTful API with RAML"><meta property="og:description" content="Now that we are aware of what needs to be done, we can go about designing the RESTful API that will be used to process and persist those vital mince pies."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-11T00:00:00+00:00"><meta property="article:modified_time" content="2018-06-11T00:00:00+00:00"><meta property="article:tag" content="Rest"><meta property="article:tag" content="Raml"><meta property="article:tag" content="Mince-Pie-Challenge-Series"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mince Pie Challenge: Designing the RESTful API with RAML"><meta name=twitter:description content="Now that we are aware of what needs to be done, we can go about designing the RESTful API that will be used to process and persist those vital mince pies."><meta name=twitter:site content="@edd_mann"><link rel="preload stylesheet" as=style href=/css/style.min.866f0dbf24963ef6aab7a870ac4f1e5617707e4531cb5ea08f18fc7918a154c4.css integrity="sha256-hm8NvySWPvaqt6hwrE8eVhdwfkUxy16gjxj8eRihVMQ="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/mince-pie-challenge-designing-the-restful-api-with-raml/></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><div class=site-header__mobile-navigation-button aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></div><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1 class=transition-between-pages style=--id:mince-pie-challenge-designing-the-restful-api-with-raml>Mince Pie Challenge: Designing the RESTful API with RAML</h1><time class=post__time>Jun 11, 2018</time></header><main class=prose><p>Now that we are aware of what needs to be done, we can go about designing the RESTful API that will be used to process and persist those vital mince pies.</p><h2 id=rest-and-hal>REST and HAL</h2><p>Before we jump into the design phase, I would first like to briefly discuss the thought process behind how we will be designing this API.
We will be using <a href=https://restfulapi.net/ rel="external noopener" target=_blank>REST</a> (Representational State Transfer), which is a flexible architectural style for distributed hypertext-driven systems.
Following this approach allows for clear client/server separation (different rates of change), encapsulated state transitions and increased discoverability (via <a href=https://restfulapi.net/hateoas/ rel="external noopener" target=_blank>HATEOAS</a>).
The server dictates what data/actions to return and how to react to desired client action requests, while the client is tasked with presenting this data and actions to the user.</p><p>We will also be using <a href=http://stateless.co/hal_specification.html rel="external noopener" target=_blank>HAL</a> (Hypertext Application Language), which is a simple format for providing hyperlinks between resources.
This enables your API to be discoverable to both humans and machines alike.</p><p>If you wish to learn more, I have had the good fortune to discuss both REST and HAL at length with <a href=https://threedevsandamaybe.com/designing-apis-with-camille-baldock/ rel="external noopener" target=_blank>knowledgeable</a> <a href=https://threedevsandamaybe.com/api-ramblings-with-phil-sturgeon/ rel="external noopener" target=_blank>guests</a> on past episodes of my podcast.</p><h2 id=raml>RAML</h2><p><a href=https://raml.org/ rel="external noopener" target=_blank>RAML</a> (RESTful API Modelling Language) is a language to easily describe RESTful APIs.
Following this format allows us to easily map out how an API will work and respond to a consumer, before a single line of code needs to be written.
At MyBuilder we have found it highly beneficial to use an API design tool such as RAML at the start of building a new API.
In doing so, we are able to flush out the requirements in a more concrete manner, whilst still maintaining quick feedback loops.</p><h2 id=bootstrap>Bootstrap</h2><p>Every story has a beginning, and our API is the bootstrap request.
As a client, all I am initially aware of is a single endpoint and the protocol that we wish to communicate over.
To aid the client in discovering more about our service, we will respond with all the available actions and some key configuration information for setting up <a href=https://aws.amazon.com/cognito/ rel="external noopener" target=_blank>Amazon Cognito</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>/</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>get</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Provides available actions and Cognito authentication pool identifiers.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>200</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/hal+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;self&#34;: { &#34;href&#34;: &#34;/&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;list&#34;: { &#34;href&#34;: &#34;/pies&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;add&#34;: { &#34;href&#34;: &#34;/pies&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;view&#34;: { &#34;href&#34;: &#34;/pies/{id}&#34;, &#34;templated&#34;: true }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;cognito&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;poolId&#34;: &#34;eu-west-1_BXXROsWOu&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;clientId&#34;: &#34;3qf6pqo467hr1tcbm3kf5sn2v3&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;baseEndpointUrl&#34;: &#34;https://api.mincepiechallenge.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>Adding this additional layer of indirection in providing these actions allows us to remain in control over what the client is able to do (and how) at any given time.
This provides us with a valuable form of decoupling, with the ability to change endpoints and actions at a later date without any input from the consumer.</p><h2 id=authentication>Authentication</h2><p>This service will delegate authenticating the client to Amazon Cognito and <a href=https://jwt.io/ rel="external noopener" target=_blank>JSON Web Tokens</a>.
This alleviates us from having to cater for user signup and login activities within the API.
Instead, we are required to only ensure that a given client is authorised and meets the desired authorisation in place.
The different forms of endpoint we will be using are as follows:</p><ul><li><strong>Public</strong> - accessible to any client request.</li><li><strong>Optional Authentication</strong> - the response may differ based on whether the client is authenticated or not.</li><li><strong>Strict Authentication</strong> - the endpoint requires the client to be authenticated.</li></ul><p>We have already seen a public endpoint in the form of the bootstrap resource, which is available to any client request.
To permit the other two forms, we will be using JSON Web Tokens.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>securitySchemes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>optional-jwt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Optionally provide a valid JSON Web Token.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>x-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>describedBy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Authorization</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Used to send a JSON Web Token with the request.</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>strict-jwt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Requires a valid JSON Web Token be provided.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>x-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>describedBy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>Authorization</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Used to send a JSON Web Token with the request.</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>401</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;title&#34;: &#34;Unauthorized&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;detail&#34;: &#34;Service requires an authenticated user&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }</span>
</span></span></code></pre></div><p>RAML allows us to document how the process works, detailing the client request requirements and possible authentication-related responses.</p><h2 id=managing-the-pies>Managing the Pies</h2><p>Now that we have validated who we are to the API, we can go about documenting how we expect to add and remove pies within the challenge.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>/pies</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>post</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Add a new mince pie to the challenge.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>securedBy</span>: <span style=color:#ae81ff>strict-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>application/json</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          { &#34;name&#34;: &#34;Awesome Mince Pie&#34; }</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>201</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>Location</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: <span style=color:#e6db74>&#39;/pies/9d197f40&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/hal+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;self&#34;: { &#34;href&#34;: &#34;/pies/9d197f40&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;photo&#34;: { &#34;href&#34;: &#34;/pies/9d197f40/photo&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;id&#34;: &#34;9d197f40&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;Awesome Mince Pie&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;addedAt&#34;: &#34;2018-06-11T12:00:00.000Z&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;rating&#34;: { &#34;avg&#34;: 0, &#34;total&#34;: 0 }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>400</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Bad Request&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Invalid request body&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;errors&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  { &#34;name&#34;: &#34;name&#34;, &#34;reason&#34;: &#34;You must supply the pie&#39;s name.&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>/pies/{id}:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>delete</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Remove a specified mince pie from the challenge.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>securedBy</span>: <span style=color:#ae81ff>strict-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>204</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Successfully deleted the mince pie.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>403</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Forbidden&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;This mince pie does not belong to you.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>404</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Not Found&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Unable to find the specified mince pie.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>We expect the authenticated client (denoted using <code>securedBy</code>) to provide us with a valid pie to add to the challenge, else we will return a sufficient error (following <a href=https://tools.ietf.org/html/rfc7807 rel="external noopener" target=_blank>Problem Details for HTTP APIs</a>).
Similarly, we are able to remove a specified pie, providing that the client is authorised to do so (the pie owner).</p><h2 id=uploading-a-photo>Uploading a Photo</h2><p>We wish to delegate the responsibility of uploading and persisting the client&rsquo;s pie photos to <a href=https://aws.amazon.com/s3/ rel="external noopener" target=_blank>Amazon S3</a>.
To do so, we need a process in which to allow the client to request a given unique endpoint to upload these to.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>/pies/{id}/photo:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>put</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Request a new photo upload URL.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>securedBy</span>: <span style=color:#ae81ff>strict-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>application/json</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;fileExtension&#34;: &#34;jpg&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;contentType&#34;: &#34;image/jpg&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          }</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>201</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>Location</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: <span style=color:#e6db74>&#39;http://s3.com/upload/9d197f40&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/hal+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;self&#34;: { &#34;href&#34;: &#34;http://s3.com/upload/9d197f40&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;url&#34;: &#34;http://s3.com/upload/9d197f40&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>400</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Bad Request&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Invalid request body&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;errors&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  { &#34;name&#34;: &#34;fileExtension&#34;, &#34;reason&#34;: &#34;You must supply the file extension.&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  { &#34;name&#34;: &#34;contentType&#34;, &#34;reason&#34;: &#34;You must supply the content-type.&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>403</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>examples</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>not-owner</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;title&#34;: &#34;Forbidden&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;detail&#34;: &#34;This mince pie does not belong to you.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>photo-present</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;title&#34;: &#34;Forbidden&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;detail&#34;: &#34;This mince pie already has a photo.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>404</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Not Found&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Unable to find the specified mince pie.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>Providing the authenticated client owns the specified pie, we accept the desired photo&rsquo;s extension and content-type.
From this, we return a unique endpoint that the client can upload the expected file to.
This allows us to remain in control of what content gets uploaded, but without the need to actually manage the upload process itself.</p><h2 id=viewing-the-pies>Viewing the Pies</h2><p>To allow the client to browse all the available pies, we will provide a listing which partially embeds all the pie resources (saving on many HTTP requests).
Although this is not strictly allowed within the HAL specification (it should be the entire sub-resource), we have found no negative impact in following this practise, &lsquo;filling in the rest&rsquo; upon subsequent client requests to the specific resource.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>/pies</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>get</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>List all available mince pies in the challenge.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>200</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/hal+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;self&#34;: { &#34;href&#34;: &#34;/pies&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_embedded&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;pies&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        &#34;self&#34;: { &#34;href&#34;: &#34;/pies/9d197f40&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      &#34;id&#34;: &#34;9d197f40&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      &#34;name&#34;: &#34;Awesome Mince Pie&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      &#34;thumbnail&#34;: &#34;http://s3.com/9d197f40.jpg&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                      &#34;rating&#34;: { &#34;avg&#34;: 5, &#34;total&#34;: 1 }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;total&#34;: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>In the case of a detailed pie view, we wish to provide the client with the possible actions that are available to them.
These will differ based on whether they are authenticated and/or the owner of the specified pie.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>/pies/{id}:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>get</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>View a specified mince pie.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>securedBy</span>: <span style=color:#ae81ff>optional-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>200</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/hal+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;_links&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;self&#34;: { &#34;href&#34;: &#34;/pies/9d197f40&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;photo?&#34;: { &#34;href&#34;: &#34;/pies/9d197f40/photo&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;rate?&#34;: { &#34;href&#34;: &#34;/pies/9d197f40/rate&#34; },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  &#34;remove?&#34;: { &#34;href&#34;: &#34;/pies/9d197f40&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;id&#34;: &#34;9d197f40&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;name&#34;: &#34;Awesome Mince Pie&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;addedAt&#34;: &#34;2018-06-11T012:00:00.000Z&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;photo&#34;: &#34;http://s3.com/original/9d197f40.jpg&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;thumbnail&#34;: &#34;http://s3.com/9d197f40.jpg&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;rating&#34;: { &#34;avg&#34;: 0, &#34;total&#34;: 0 }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>404</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Not Found&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Unable to find the specified mince pie.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>We specify that the <code>rate</code>, <code>remove</code> and <code>photo</code> actions could be optionally present.
This is due to the imposed restrictions on who can remove or upload a photo for the pie (the owner), and if the authenticated client has already given a rating to this pie.</p><h2 id=rating-the-pies>Rating the Pies</h2><p>Finally, there would be no challenge if we were not able to actually rate the pies.
Providing that the authenticated client has not already rated the pie, we allow them to submit a desired rating.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>/pies/{id}/rate:</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>put</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Rate a specified mince pie.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>securedBy</span>: <span style=color:#ae81ff>strict-jwt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>application/json</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          { &#34;rating&#34;: 5 }</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>responses</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>204</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Successfully rated the mince pie.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>400</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Bad Request&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Invalid request body&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;errors&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                  { &#34;name&#34;: &#34;rating&#34;, &#34;reason&#34;: &#34;You must supply a valid pie rating.&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>403</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Forbidden&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;You have already rated this mince pie.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>404</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>body</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>application/problem+json</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>object</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>example</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;title&#34;: &#34;Not Found&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;detail&#34;: &#34;Unable to find the specified mince pie.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              }</span>
</span></span></code></pre></div><p>If the rating does not meet the requirements, we return a sufficient error to the client, else we signify success based on the returned HTTP status code.</p><h2 id=exploring-the-api>Exploring the API</h2><p>We are now able to experiment with this API, using proposed user stories and exploring how the state transitions work.
There are many <a href=https://github.com/mulesoft/osprey rel="external noopener" target=_blank>different</a> <a href=https://github.com/RePoChO/raml-mocker rel="external noopener" target=_blank>tools</a> available to bring this API to life, allowing you to handle mock service calls.</p><p>I have found it beneficial to produce clear, easy-to-read documentation from the specification using <a href=https://github.com/raml2html/raml2html rel="external noopener" target=_blank>raml2html</a>.
You can explore this <a href>documentation</a> and the complete underlying <a href=/posts/mince-pie-challenge-designing-the-restful-api-with-raml/api.raml>specification</a> at your leisure.</p><p><a href><picture><source type=image/webp srcset="/posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_7d0d53851a45f89f.webp 350w, /posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_2cdf670f1abd7af2.webp 700w, /posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_1cebeb59d176d31f.webp 1400w"><source type=image/jpeg srcset="/posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_9cd6bfe0b9eb856b.jpg 350w, /posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_f90270db2b7f2932.jpg 700w, /posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_75f939237324ab8b.jpg 1400w"><img src=/posts/mince-pie-challenge-designing-the-restful-api-with-raml/api-documentation_hu_f90270db2b7f2932.jpg alt="API Documentation" loading=lazy></picture></a></p><p>With the API design now finalised, we can move on to actually building it!
Join me in the <a href=/posts/mince-pie-challenge-setting-up-the-serverless-framework-with-docker-webpack-and-babel/>next post</a> of the <a href=/archive/tag/mince-pie-challenge-series>series</a>, where we will go about locally setting up the Serverless Framework with Docker, Webpack and Babel.</p></main><footer class=post__tags><a href=/archive/tag/rest>rest</a><a href=/archive/tag/raml>raml</a><a href=/archive/tag/mince-pie-challenge-series>mince-pie-challenge-series</a></footer></article><div class=scroll-watcher></div></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div></footer><script>(function(){document.querySelector(".site-header__mobile-navigation-button").addEventListener("click",e=>{document.documentElement.classList.toggle("mobile-navigation-open"),e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")});const n=document.querySelector(".site-header");let t=window.pageYOffset,e=!1;window.addEventListener("scroll",()=>{if(e)return;setTimeout(()=>{const s=window.pageYOffset;n.classList.toggle("is-sticky",s>0&&t>s),t=s,e=!1},500),e=!0})})()</script></body></html>