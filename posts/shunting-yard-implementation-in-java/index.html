<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Implementing a basic Shunting Yard (Infix to Postfix) algorithm in Java.">

    <title>Shunting Yard Implementation in Java &middot; Edd Mann</title>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    <script>
        var _gaq=[['_setAccount','UA-32512081-1'],['_setDomainName','eddmann.com'],['_trackPageview']];
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = 'https://ssl.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Shunting Yard Implementation in Java</h1>
    <time datetime="2013-12-23T00:00:00-06:00" class="post-date">23 Dec 2013</time>
    <p>The Shunting Yard algorithm was developed by the great <a href="http://en.wikipedia.org/wiki/Edsger_Dijkstra">Edsger Dijkstra</a> as a means to parse an infix mathematical expression into Reverse Polish notation (postfix).
Using said notation allows the computer to evaluate the expression in a simple stack based form, <a href="/posts/reverse-polish-notation-rpn-in-scala/">examples</a> of which I have shown in Scala.
The algorithm itself also uses a stack along with a built-up output string to create the resulting value.
Below is an example implementation which only takes into consideration bracket and the four common operator precedences.
Although it is possible to evaluate more, including functions and associativity, I decided on keeping the implementation simple to better highlight the process.
</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShuntingYard</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">enum</span> <span class="nc">Operator</span>
    <span class="o">{</span>
        <span class="no">ADD</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="no">SUBTRACT</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="no">MULTIPLY</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="no">DIVIDE</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">precedence</span><span class="o">;</span>
        <span class="nc">Operator</span><span class="o">(</span><span class="kt">int</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="n">precedence</span> <span class="o">=</span> <span class="n">p</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">&gt;</span> <span class="n">ops</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">&gt;()</span> <span class="o">{{</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"+"</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">.</span><span class="na">ADD</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">.</span><span class="na">SUBTRACT</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">.</span><span class="na">MULTIPLY</span><span class="o">);</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="nc">Operator</span><span class="o">.</span><span class="na">DIVIDE</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isHigerPrec</span><span class="o">(</span><span class="nc">String</span> <span class="n">op</span><span class="o">,</span> <span class="nc">String</span> <span class="n">sub</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">ops</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">sub</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">ops</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">sub</span><span class="o">).</span><span class="na">precedence</span> <span class="o">&gt;=</span> <span class="n">ops</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">op</span><span class="o">).</span><span class="na">precedence</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">postfix</span><span class="o">(</span><span class="nc">String</span> <span class="n">infix</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="nc">Deque</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">stack</span>  <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;&gt;();</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">token</span> <span class="o">:</span> <span class="n">infix</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\\s"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// operator</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">ops</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">token</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span> <span class="o">!</span> <span class="n">stack</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">isHigerPrec</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="n">stack</span><span class="o">.</span><span class="na">peek</span><span class="o">()))</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">pop</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>
                <span class="n">stack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>

            <span class="c1">// left parenthesis</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"("</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">stack</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>

            <span class="c1">// right parenthesis</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">")"</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">while</span> <span class="o">(</span> <span class="o">!</span> <span class="n">stack</span><span class="o">.</span><span class="na">peek</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"("</span><span class="o">))</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">pop</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>
                <span class="n">stack</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>

            <span class="c1">// digit</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">token</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">while</span> <span class="o">(</span> <span class="o">!</span> <span class="n">stack</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
            <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">pop</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>The example implementation above first creates an enumerated type called ‘Operator’ which stores the incrementing precedence of the four operators.
Following this a map is initalised using <a href="http://c2.com/cgi/wiki?DoubleBraceInitialization">double bracket syntax</a>, pairing the enumerated type with its symbol equivalent.
Supplying the postfix method with an infix string splits (on white-space) and evaluates each token.
The next step depends on the subject matter, if the token is a digit it will be added to the output string immediately.
If on the other hand it is a left parenthesis, it is added to the stack and kept there until a pairing right parenthesis appears.
When this is the case, the stack contents is added to the output string until it arrives back at the left parenthesis.
If the token is an operator each stack operator item is appended to the output string until the token operator has a greater precedence, once complete the subject token is pushed to the stack.
Finally, the remaining items in the stack are appended to the output builder and a string instance of the StringBuilder is returned.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">postfix</span><span class="o">(</span><span class="s">"( 5 + 7 ) * 2"</span><span class="o">)</span> <span class="c1">// 5 7 + 2 *</span>
<span class="n">postfix</span><span class="o">(</span><span class="s">"5 + 7 / 2"</span><span class="o">)</span>     <span class="c1">// 5 7 2 / +</span>
</code></pre></div></div>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://andreinc.net/2010/10/05/converting-infix-to-rpn-shunting-yard-algorithm/">Converting Infix to RPN</a></li>
  <li><a href="http://www.youtube.com/watch?v=QzVVjboyb0s">Shunting Yard Algorithm - Intro and Reverse Polish Notation</a></li>
  <li><a href="http://cs.stackexchange.com/questions/4666/what-is-the-significance-of-reverse-polish-notation">What is the significance of Reverse Polish notation?</a></li>
  <li><a href="http://c2.com/cgi/wiki?DoubleBraceInitialization">Double Brace Initialisation</a></li>
</ul>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
