<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Solving the Advent of Code 2015 Day 18 puzzle using TypeScript">

    <title>
        
            Advent of Code 2015 - Day 18 - Like a GIF For Your Yard &middot; Edd Mann
        
    </title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script>
    <script>
       window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'G-ZPQ7WHNXH4');
    </script>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Advent of Code 2015 - Day 18 - Like a GIF For Your Yard</h1>
    <time datetime="2021-02-11T00:00:00+00:00" class="post-date">11 Feb 2021</time>
    <p>On the eighteenth day of Advent of Code 2015 we are asked to re-arrange the light show we created on <a href="https://eddmann.com/posts/advent-of-code-2015-day-6-probably-a-fire-hazard/">a previous day</a>.</p>



<h3 id="part-1">Part 1</h3>

<p>We are supplied with an initial 100x100 grid of light states (on or off) and told that Santa has provided us with rules to follow to produce this new light show.
These rules follow the <a href="https://en.wikipedia.org/wiki/Conway's_Game_of_Life">Conwayâ€™s Game of Life</a>, like so:</p>

<ul>
  <li>A light which is on stays on when 2 or 3 neighbors are on, and turns off otherwise.</li>
  <li>A light which is off turns on if exactly 3 neighbors are on, and stays off otherwise.</li>
</ul>

<p>We begin by parsing the provided initial light state grid into a form we can process.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">Light</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kr">number</span><span class="p">];</span>
<span class="kd">type</span> <span class="nx">OnLights</span> <span class="o">=</span> <span class="nx">CompoundSet</span><span class="o">&lt;</span><span class="nx">Light</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">parseGrid</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">input</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">):</span> <span class="p">[</span><span class="nx">upperBounds</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">lights</span><span class="p">:</span> <span class="nx">OnLights</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="nx">rows</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">on</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[...</span><span class="nx">line</span><span class="p">].</span><span class="nx">reduce</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">on</span><span class="p">,</span> <span class="nx">light</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">light</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">#</span><span class="dl">'</span> <span class="p">?</span> <span class="nx">on</span><span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">])</span> <span class="p">:</span> <span class="nx">on</span><span class="p">),</span>
        <span class="nx">on</span>
      <span class="p">);</span>
    <span class="p">},</span> <span class="k">new</span> <span class="nx">CompoundSet</span><span class="o">&lt;</span><span class="nx">Light</span><span class="o">&gt;</span><span class="p">()),</span>
  <span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<p>We iterate through the initial grid, building up a <a href="https://eddmann.com/posts/implementing-a-compound-set-in-typescript/">CompoundSet</a> of all the lights that are currently on (identified by their x and y coordinates).
So as to manage the bounds within future calculations we return the upper-bounds value of the grid (in this case 100) to the callee as well.</p>

<p>From here, we then create a function which supplied with the upper-bounds and the current light coordinates returns all the possible neighbouring light positions.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">Neighbours</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span><span class="p">:</span> <span class="nx">Light</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Light</span><span class="p">[];</span>

<span class="kd">const</span> <span class="nx">neighboursFor</span> <span class="o">=</span> <span class="p">(</span><span class="nx">upperBounds</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">Neighbours</span> <span class="o">=&gt;</span> <span class="p">([</span>
  <span class="nx">x</span><span class="p">,</span>
  <span class="nx">y</span><span class="p">,</span>
<span class="p">]:</span> <span class="nx">Light</span><span class="p">):</span> <span class="nx">Light</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">neighbours</span><span class="p">:</span> <span class="nx">Light</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">dx</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">dx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">dy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">dy</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">dy</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">[</span><span class="nx">nx</span><span class="p">,</span> <span class="nx">ny</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">dx</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">dy</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">ny</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nx</span> <span class="o">&gt;=</span> <span class="nx">upperBounds</span> <span class="o">||</span> <span class="nx">ny</span> <span class="o">&gt;=</span> <span class="nx">upperBounds</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nx">neighbours</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">nx</span><span class="p">,</span> <span class="nx">ny</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">neighbours</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Their is a little guard logic above to ensure that any adjacent subject light is within the bounds of the grid.
Supplying this function partial applied with the desired upper-bounds we are able to begin codifying the animation state transitions.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">animate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">neighboursFor</span><span class="p">:</span> <span class="nx">Neighbours</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="nx">lights</span><span class="p">:</span> <span class="nx">OnLights</span>
<span class="p">):</span> <span class="nx">OnLights</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">onWithNeighours</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CompoundSet</span><span class="o">&lt;</span><span class="nx">Light</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="p">[...</span><span class="nx">lights</span><span class="p">].</span><span class="nx">reduce</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">lights</span><span class="p">,</span> <span class="nx">light</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">lights</span><span class="p">,</span> <span class="nx">light</span><span class="p">,</span> <span class="p">...</span><span class="nx">neighboursFor</span><span class="p">(</span><span class="nx">light</span><span class="p">)],</span>
      <span class="p">[]</span>
    <span class="p">)</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">CompoundSet</span><span class="o">&lt;</span><span class="nx">Light</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="p">[...</span><span class="nx">onWithNeighours</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nx">light</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">active</span> <span class="o">=</span> <span class="nx">neighboursFor</span><span class="p">(</span><span class="nx">light</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">lights</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">l</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">active</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="p">(</span><span class="nx">active</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">lights</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">light</span><span class="p">));</span>
    <span class="p">})</span>
  <span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Based on the provided set of lights that are currenty <em>on</em>, we determine the listing of all these lights including any valid neighbouring light positions.
Combined these are all the possible lights that could be returned from this state transition as on.
From here, we filter done to only include lights that meet the rules explained above.</p>

<p>Combining all this functionality together (and with the help of the <code class="language-plaintext highlighter-rouge">repeat</code> function we created on a previous day), we can iterate over this animation for 100 transitions, and return the desired count of the lights that are on ðŸŒŸ.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">upperBounds</span><span class="p">,</span> <span class="nx">lights</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parseGrid</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">animate</span><span class="p">(</span><span class="nx">neighboursFor</span><span class="p">(</span><span class="nx">upperBounds</span><span class="p">)),</span> <span class="nx">lights</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">size</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="part-2">Part 2</h3>

<p>For part two, we are told that it appears that the lights we bought have <em>stuck corners</em> where-by these lights are always left on.
We are told to apply this new characteristic and repeat the 100 iterations from the initial grid state again.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cornersStuckOn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">upperBounds</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="nx">lights</span><span class="p">:</span> <span class="nx">OnLights</span>
<span class="p">):</span> <span class="nx">OnLights</span> <span class="o">=&gt;</span>
  <span class="nx">lights</span>
    <span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">upperBounds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="nx">upperBounds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="nx">upperBounds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">upperBounds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</code></pre></div></div>

<p>In a similiar fashion to how we partially applied the <code class="language-plaintext highlighter-rouge">neighboursFor</code> function above, we do the same for ensuring that the supplied lights that are on maintain the <em>stuck corners</em>.
With this new functionality we can compose all the building blocks together, returning the desired new count of lights that are on ðŸŒŸ.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">upperBounds</span><span class="p">,</span> <span class="nx">lights</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parseGrid</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">stuck</span> <span class="o">=</span> <span class="nx">cornersStuckOn</span><span class="p">(</span><span class="nx">upperBounds</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">animate</span><span class="p">(</span><span class="nx">neighboursFor</span><span class="p">(</span><span class="nx">upperBounds</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="na">l</span><span class="p">:</span> <span class="nx">OnLights</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">stuck</span><span class="p">(</span><span class="nx">action</span><span class="p">(</span><span class="nx">l</span><span class="p">)),</span> <span class="nx">stuck</span><span class="p">(</span><span class="nx">lights</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">size</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Upon reflection I did find this solution to be rather slow.
I opted for readability and clear problem solving over an optimised answer response.
In the future I hope to explore this problem further and improve on its performance characteristics.</p>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
