<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Storing PHP Sessions/File Caches in Memory using TMPFS - Edd Mann</title>
<meta name=description content="Optimise your PHP sessions and file caches using TMPFS to boost I/O performance on your Linux system."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Storing PHP Sessions/File Caches in Memory using TMPFS"><meta itemprop=description content="Yesterday I was looking through some application logs and noticed a significant bottleneck with I/O reads in the implemented file cache. This cache is used to temporarily store processed views and records for a set duration. I looked into a couple of solutions to alleviate the intense spinning disk usage, ranging from Memcache to Redis. These products are great for large-scale applications spread over multiple systems. However, in my case, a single local configuration was sufficient."><meta itemprop=datePublished content="2014-04-16T00:00:00+00:00"><meta itemprop=dateModified content="2014-04-16T00:00:00+00:00"><meta itemprop=wordCount content="357"><meta itemprop=keywords content="Php"><meta property="og:url" content="https://eddmann.com/posts/storing-php-sessions-file-caches-in-memory-using-tmpfs/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Storing PHP Sessions/File Caches in Memory using TMPFS"><meta property="og:description" content="Yesterday I was looking through some application logs and noticed a significant bottleneck with I/O reads in the implemented file cache. This cache is used to temporarily store processed views and records for a set duration. I looked into a couple of solutions to alleviate the intense spinning disk usage, ranging from Memcache to Redis. These products are great for large-scale applications spread over multiple systems. However, in my case, a single local configuration was sufficient."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-04-16T00:00:00+00:00"><meta property="article:modified_time" content="2014-04-16T00:00:00+00:00"><meta property="article:tag" content="Php"><meta name=twitter:card content="summary"><meta name=twitter:title content="Storing PHP Sessions/File Caches in Memory using TMPFS"><meta name=twitter:description content="Yesterday I was looking through some application logs and noticed a significant bottleneck with I/O reads in the implemented file cache. This cache is used to temporarily store processed views and records for a set duration. I looked into a couple of solutions to alleviate the intense spinning disk usage, ranging from Memcache to Redis. These products are great for large-scale applications spread over multiple systems. However, in my case, a single local configuration was sufficient."><meta name=twitter:site content="@edd_mann"><link rel="preload stylesheet" as=style href=/css/style.min.0121a173d3063b9541f1f561a87125fd59dc1fac6110b21c15bba8bc141b70b1.css integrity="sha256-ASGhc9MGO5VB8fVhqHEl/VncH6xhELIcFbuovBQbcLE="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/storing-php-sessions-file-caches-in-memory-using-tmpfs/></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><div class=site-header__mobile-navigation-button aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></div><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1>Storing PHP Sessions/File Caches in Memory using TMPFS</h1><time class=post__time>Apr 16, 2014</time></header><main class=prose><p>Yesterday I was looking through some application logs and noticed a significant bottleneck with I/O reads in the implemented file cache.
This cache is used to temporarily store processed views and records for a set duration.
I looked into a couple of solutions to alleviate the intense spinning disk usage, ranging from <a href=http://memcached.org/ rel="external noopener" target=_blank>Memcache</a> to <a href=http://redis.io/ rel="external noopener" target=_blank>Redis</a>.
These products are great for large-scale applications spread over multiple systems.
However, in my case, a single local configuration was sufficient.</p><p>This was when I found &rsquo;tmpfs&rsquo;, saving me from all sorts of issues relating to adding yet another application to the production stack.
&rsquo;tmpfs&rsquo; appears as a mounted partition on your system.
Under the hood, it allocates and uses a section of physical memory (non-persistent through reboots).
This means that you are able to configure directories, such as the cache, to be mounted on a &rsquo;tmpfs&rsquo; partition.
This results in the desired speed boosts without tampering with the application logic itself.
Even better, if the mount is unsuccessful for some reason, it will safely fall back to using the persistent hard-disk solution.</p><h2 id=php-sessions>PHP Sessions</h2><p>Though I have been discussing this solution in the case of caches, file-based PHP sessions can be set up in a similar manner.
You must first work out where session files for your PHP installation are stored.
Note that if you&rsquo;re using PHP-FPM, you may need to modify the second configuration line.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># /etc/php.ini</span>
</span></span><span style=display:flex><span>session.save_path <span style=color:#f92672>=</span> /var/lib/php/session
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/php-fpm.conf</span>
</span></span><span style=display:flex><span>php_value<span style=color:#f92672>[</span>session.save_path<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> /var/lib/php/session
</span></span></code></pre></div><p>We can then make sure that the directory has been created along with the fallback permissions.
To temporarily observe performance improvements, we are able to mount the &rsquo;tmpfs&rsquo; partition to the session directory, setting ownership to the desired user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /var/lib/php/session
</span></span><span style=display:flex><span><span style=color:#75715e># fallback</span>
</span></span><span style=display:flex><span>chown nginx:nginx /var/lib/php/session
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> /var/lib/php/session
</span></span><span style=display:flex><span><span style=color:#75715e># temporary mount</span>
</span></span><span style=display:flex><span>mount -t tmpfs -o size<span style=color:#f92672>=</span>32m,mode<span style=color:#f92672>=</span>0755,uid<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>id -u nginx<span style=color:#66d9ef>)</span>,gid<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>id -g nginx<span style=color:#66d9ef>)</span> tmpfs /var/lib/php/session
</span></span><span style=display:flex><span>umount /var/lib/php/session
</span></span></code></pre></div><p>If you are satisfied with the configuration, you can persist the partition mount across reboots by adding the following line to your &lsquo;fstab&rsquo; file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;tmpfs /var/lib/php/session tmpfs size=32m,uid=</span><span style=color:#66d9ef>$(</span>id -u nginx<span style=color:#66d9ef>)</span><span style=color:#e6db74>,gid=</span><span style=color:#66d9ef>$(</span>id -g nginx<span style=color:#66d9ef>)</span><span style=color:#e6db74>,mode=0755 0 0&#34;</span> &gt;&gt; /etc/fstab
</span></span></code></pre></div><h2 id=resources>Resources</h2><ul><li><a href=http://kvz.io/blog/2011/04/29/faster-php-sessions/ rel="external noopener" target=_blank>Revisiting Faster PHP Sessions</a></li><li><a href=http://www.thegeekstuff.com/2008/11/overview-of-ramfs-and-tmpfs-on-linux/ rel="external noopener" target=_blank>Overview of RAMFS and TMPFS on Linux</a></li></ul></main><footer class=post__tags><a href=/archive/tag/php>php</a></footer></article></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div></footer><script>(function(){document.querySelector(".site-header__mobile-navigation-button").addEventListener("click",e=>{document.documentElement.classList.toggle("mobile-navigation-open"),e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")});const n=document.querySelector(".site-header");let t=window.pageYOffset,e=!1;window.addEventListener("scroll",()=>{if(e)return;setTimeout(()=>{const s=window.pageYOffset;n.classList.toggle("is-sticky",t>s),t=s,e=!1},500),e=!0})})()</script></body></html>