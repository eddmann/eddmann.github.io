<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild - Edd Mann</title>
<meta name=description content="A hands-on rebuild of an F1 prediction game using NextJS 14, AWS Lambda, and CDK. Explore cutting-edge features like React Server Components, Server Actions, and serverless deployment with real-world insights."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild"><meta itemprop=description content="I rebuilt my family‚Äôs Formula 1 prediction game using NextJS 14, embracing new features like the App Router, React Server Components, and Server Actions. Deploying to AWS Lambda with the Lambda Web Adaptor was a fun challenge that pushed me to explore serverless architecture in a modern frontend context. While the code is a bit wild, the journey taught me a ton about the evolving NextJS ecosystem and infrastructure-as-code with CDK."><meta itemprop=datePublished content="2024-09-03T00:00:00+00:00"><meta itemprop=dateModified content="2024-09-03T00:00:00+00:00"><meta itemprop=wordCount content="988"><meta itemprop=keywords content="Javascript,Serverless,Nextjs,React,Aws"><meta property="og:url" content="https://eddmann.com/posts/exploring-nextjs-14-at-full-throttle-an-f1-picks-rebuild/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild"><meta property="og:description" content="I rebuilt my family‚Äôs Formula 1 prediction game using NextJS 14, embracing new features like the App Router, React Server Components, and Server Actions. Deploying to AWS Lambda with the Lambda Web Adaptor was a fun challenge that pushed me to explore serverless architecture in a modern frontend context. While the code is a bit wild, the journey taught me a ton about the evolving NextJS ecosystem and infrastructure-as-code with CDK."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-03T00:00:00+00:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Serverless"><meta property="article:tag" content="Nextjs"><meta property="article:tag" content="React"><meta property="article:tag" content="Aws"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild"><meta name=twitter:description content="I rebuilt my family‚Äôs Formula 1 prediction game using NextJS 14, embracing new features like the App Router, React Server Components, and Server Actions. Deploying to AWS Lambda with the Lambda Web Adaptor was a fun challenge that pushed me to explore serverless architecture in a modern frontend context. While the code is a bit wild, the journey taught me a ton about the evolving NextJS ecosystem and infrastructure-as-code with CDK."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.a18bbea58d05187498ffb7d6a33b580609df2e92b988055a4b51e41596cc934e.css integrity="sha256-oYu+pY0FGHSY/7fWoztYBgnfLpK5iAVaS1HkFZbMk04="><link rel=preload as=image href=/assets/x.svg crossorigin=anonymous><link rel=preload as=image href=/assets/github.svg crossorigin=anonymous><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/exploring-nextjs-14-at-full-throttle-an-f1-picks-rebuild/><script>document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")</script><script src=/script.min.da71ac9c7b8bd4e644618df0ab735aed1393aad3cb5e5c57e5adc300fe7c8209.js integrity="sha256-2nGsnHuL1OZEYY3wq3Na7ROTqtPLXlxX5a3DAP58ggk=" defer></script></head><body><header class="site-header l-wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=l-wrapper><article><header class=l-page-title><h1 class=u-transition-between-pages style=--id:exploring-nextjs-14-at-full-throttle-an-f1-picks-rebuild>Exploring NextJS 14 at Full Throttle: An F1 Picks Rebuild</h1><time datetime=2024-09-03T00:00:00Z class=published-at>Sep 3, 2024</time></header><main class=u-prose><p>If you read my previous post, <a href=/posts/building-an-f1-picks-game-in-4-hours/>&ldquo;Building an F1 Picks Game in 4 Hours: It&rsquo;s Lights Out and Away We Go!&rdquo;</a>, you&rsquo;ll know that my family and I have been enjoying a Formula 1 prediction game this season - submitting our top three picks for each race, scoring points, and keeping the family WhatsApp chat buzzing with friendly rivalry.
The MVP was built in a single evening using Laravel, with a healthy dose of ChatGPT and a dash of serverless magic to get it over the finish line.
It was a fun and frantic experience (and yes, the codebase shows it üò¨).</p><p>But, as any developer will tell you, the urge to tinker is perennial.
With the advent of <a href=https://nextjs.org/blog/next-14 rel="external noopener" target=_blank>NextJS 14</a>, boasting shiny features like the App Router, React Server Components (RSC), Suspense, Response Streaming, and Server Actions, I found myself itching for an excuse to try it all out.
Throw in the <a href=https://github.com/awslabs/aws-lambda-web-adapter rel="external noopener" target=_blank>Lambda Web Adaptor</a> and the <a href=https://aws.amazon.com/cdk/ rel="external noopener" target=_blank>AWS CDK</a>, and I had a full grid of technologies just waiting to be unleashed.</p><p>So, I decided to reimplement F1 Picks from the ground up.
Let&rsquo;s dive into the build! üö¶</p><p><img src=/posts/exploring-nextjs-14-at-full-throttle-an-f1-picks-rebuild/demo.gif alt="Demo of the F1 Picks application using NextJS" loading=lazy></p><h2 id=whats-under-the-hood>What&rsquo;s Under the Hood?</h2><p>Before getting stuck in, here&rsquo;s a quick rundown of the technologies I used:</p><ul><li><strong>NextJS 14</strong>: Exploring App Router, React Server Components, Suspense, Response Streaming and Server Actions.</li><li><strong>Prisma</strong>: For persistence requirements.</li><li><strong>NextAuth.js</strong>: For Google OAuth login.</li><li><strong>AWS Lambda + Lambda Web Adaptor</strong>: For running NextJS on serverless infrastructure.</li><li><strong>AWS CDK</strong>: For infrastructure-as-code concerns.</li></ul><p>For those keen to see the final result, you&rsquo;ll find everything on <a href=https://github.com/eddmann/f1-picks-nextjs rel="external noopener" target=_blank>GitHub</a>.</p><p><strong>Disclaimer:</strong> This was a glorious mix of untested domain, persistence, and presentation logic - ala 2000&rsquo;s PHP üò¨.</p><h2 id=lap-1-setting-up-nextjs-14>Lap 1: Setting Up NextJS 14</h2><p>I started by scaffolding a new NextJS 14 project, opting straight away for the App Router and enabling all the latest features.
If you haven&rsquo;t tried React Server Components (RSC) yet, I thoroughly recommend it - just be prepared for a few &ldquo;wait, where did my state go?&rdquo; moments.</p><p><strong>Key takeaways:</strong></p><ul><li><strong>App Router</strong>: Enables layouts, nested routes, and server-driven navigation.</li><li><strong>RSC</strong>: Lets you fetch data directly in your components (on the server), reducing client-side JavaScript and improving performance.</li><li><strong>Suspense & Streaming</strong>: Pages can be streamed as data loads, which is magic for perceived performance.</li></ul><p>If you&rsquo;re curious about RSC and streaming, this <a href=https://frontendmasters.com/courses/intermediate-next-js/ rel="external noopener" target=_blank>Frontend Masters course</a> was invaluable - well worth checking out.</p><h2 id=lap-2-adding-authentication-with-nextauthjs>Lap 2: Adding Authentication with NextAuth.js</h2><p>Having used Google OAuth in the Laravel version, I wanted to keep things familiar for my family (and for myself).
<a href=https://next-auth.js.org/ rel="external noopener" target=_blank>NextAuth.js</a> made this refreshingly straightforward.</p><p>I found that integrating NextAuth.js with the App Router requires a dash of patience and a good grasp of the new server/client boundaries.
The docs are getting better, but expect to do a bit of trial and error.</p><h2 id=lap-3-persistence-with-prisma>Lap 3: Persistence with Prisma</h2><p>Swapping out Laravel&rsquo;s Eloquent for Prisma was relatively painless.
I defined my schema (users, rounds, picks, results) in <code>schema.prisma</code>, ran a quick <code>prisma migrate dev</code>, and was up and running.</p><p>Example of a simple <code>Round</code> model:</p><pre tabindex=0><code class=language-prisma data-lang=prisma>model Round {
  year               Int
  round              Int
  name               String
  sprintQualifyingAt DateTime?
  sprintRaceAt       DateTime?
  raceQualifyingAt   DateTime
  raceAt             DateTime
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  picks   Pick[]
  results Result[]

  @@id(name: &#34;roundId&#34;, [year, round])
}
</code></pre><p>Prisma&rsquo;s TypeScript integration is excellent, and being able to use the type-safe generated client directly in my RSCs was very useful.</p><h2 id=lap-4-deploying-nextjs-to-lambda-with-lambda-web-adaptor>Lap 4: Deploying NextJS to Lambda with Lambda Web Adaptor</h2><p>This was the part I was most excited about.</p><p>Deploying Next.js 14 - especially with its new server features - isn&rsquo;t exactly trivial on AWS Lambda.
Thankfully, the <a href=https://github.com/awslabs/aws-lambda-web-adapter rel="external noopener" target=_blank>Lambda Web Adaptor</a> makes it possible by allowing Lambda to handle HTTP requests just like a traditional Node.js server.</p><p>I used the adapter to run my app in Lambda with full support for streaming responses, which are critical for React Server Components and Suspense in Next.js 14.
The key was packaging the app in <code>standalone</code> mode and using <code>response_stream</code> invoke mode for low-latency, streamed responses.</p><p>Here&rsquo;s the full Dockerfile I used:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> public.ecr.aws/lambda/nodejs:20 AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /build</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package*.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> prisma ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm npm ci<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./ ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> rm prisma/seed.ts<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/build/.next/cache npm run build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> public.ecr.aws/lambda/nodejs:20 AS runner</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>public.ecr.aws/awsguru/aws-lambda-adapter:0.8.4 /lambda-adapter /opt/extensions/lambda-adapter<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> HOSTNAME<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.0.0.0<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> AWS_LWA_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> AWS_LWA_READINESS_CHECK_PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/api/health&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> AWS_LWA_INVOKE_MODE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;response_stream&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> AWS_LWA_ENABLE_COMPRESSION<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /build/next.config.mjs ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /build/public ./public<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /build/.next/static ./.next/static<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /build/.next/standalone ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /build/run.sh ./run.sh<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> ln -s /tmp/cache ./.next/cache<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;sh&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;run.sh&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>These environment variables were of note:</p><ul><li><code>AWS_LWA_INVOKE_MODE="response_stream"</code> for enabling streaming.</li><li><code>AWS_LWA_READINESS_CHECK_PATH="/api/health"</code> for effective health checks.</li><li><code>AWS_LWA_ENABLE_COMPRESSION=true</code> to improve response size and speed.</li></ul><p>I based alot of this work on one of the Docker <a href=https://github.com/awslabs/aws-lambda-web-adapter/tree/main/examples/nextjs/app rel="external noopener" target=_blank>example</a> available in the Lambda Web Adapter repository.</p><h2 id=pit-lane-what-i-learned>Pit Lane: What I Learned</h2><p>This project was a fantastic excuse to get hands-on with the newest NextJS features and to experiment with deploying a full-featured app to AWS Lambda using tools like the Lambda Web Adaptor and AWS CDK.
Here are some reflections from the journey:</p><ul><li><strong>NextJS 14</strong> is incredibly powerful, but the learning curve - especially around RSCs, Suspense, and the server/client split - can be steep. Expect to spend some time debugging hydration issues and wrangling types.</li><li><strong>Serverless hosting</strong> for NextJS is maturing rapidly. With the Lambda Web Adaptor and examples from the AWS community, you can get surprisingly far with a modest amount of effort.</li><li><strong>Prisma</strong> makes TypeScript database interactions a breeze - especially compared to some older ORMs I&rsquo;ve wrangled with.</li><li><strong>AWS CDK</strong> was another shift. I&rsquo;ve been very accustomed to Terraform&rsquo;s DSL, so moving to a general-purpose programming language took some adjustment. While I initially missed the declarative style, the flexibility and power of CDK&rsquo;s <a href=https://docs.aws.amazon.com/cdk/v2/guide/constructs.html rel="external noopener" target=_blank>Construct</a> abstractions really grew on me. Of course, with great power comes great responsibility - you have to be disciplined in how you structure and use that power.</li></ul><p>Until the next rebuild, I&rsquo;ll see you in the pit lane. üèÅ</p></main><footer class=post-footer><ul class="tags tags--large"><li><a href=/archive/tag/javascript>javascript</a></li><li><a href=/archive/tag/serverless>serverless</a></li><li><a href=/archive/tag/nextjs>nextjs</a></li><li><a href=/archive/tag/react>react</a></li><li><a href=/archive/tag/aws>aws</a></li></ul><div class=related><h3 class=related__title>Related Posts</h3><ul class=related__posts><li><a href=/posts/mince-pie-challenge-building-a-serverless-restful-api-and-react-client/>Mince Pie Challenge: Building a Serverless RESTful API and React Client</a></li><li><a href=/posts/can-you-name-that-aws-service/>Can you name that AWS service?</a></li><li><a href=/posts/mince-pie-challenge-viewing-and-removing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Viewing and Removing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/mince-pie-challenge-adding-and-listing-mince-pies-with-amazon-dynamodb/>Mince Pie Challenge: Adding and Listing Mince Pies with Amazon DynamoDB</a></li><li><a href=/posts/creating-a-winning-audio-lambda-service-using-serverless-polly-and-compiled-sox/>Creating a 'Winning' Audio Lambda Service using Serverless, Polly and compiled SOX</a></li></ul></div></footer></article><div class=scroll-watcher></div></main><footer class="site-footer l-wrapper"><div>&copy; 2025, Edd Mann</div><button class=site-footer__theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>