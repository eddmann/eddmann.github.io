<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Managing Jenkins Project Builds and Configuration using PHP - Edd Mann</title>
<meta name=description content="Learn how to efficiently manage Jenkins project builds and configuration using PHP for seamless CI/CD integration."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Managing Jenkins Project Builds and Configuration using PHP"><meta itemprop=description content="Throughout project development we use Jenkins to provide meaningful test feedback on each Git push event. These builds are required to gain sufficient confidence for merging into master and subsequent deployment. Each team member manages their own project with the current project/branch they are working on. However, typically we find ourselves working on multiple branches throughout the day, and it can become cumbersome to update the project’s configuration."><meta itemprop=datePublished content="2015-07-08T00:00:00+00:00"><meta itemprop=dateModified content="2015-07-08T00:00:00+00:00"><meta itemprop=wordCount content="673"><meta itemprop=keywords content="Jenkins,Php"><meta property="og:url" content="https://eddmann.com/posts/managing-jenkins-project-builds-and-configuration-using-php/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Managing Jenkins Project Builds and Configuration using PHP"><meta property="og:description" content="Throughout project development we use Jenkins to provide meaningful test feedback on each Git push event. These builds are required to gain sufficient confidence for merging into master and subsequent deployment. Each team member manages their own project with the current project/branch they are working on. However, typically we find ourselves working on multiple branches throughout the day, and it can become cumbersome to update the project’s configuration."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-08T00:00:00+00:00"><meta property="article:modified_time" content="2015-07-08T00:00:00+00:00"><meta property="article:tag" content="Jenkins"><meta property="article:tag" content="Php"><meta name=twitter:card content="summary"><meta name=twitter:title content="Managing Jenkins Project Builds and Configuration using PHP"><meta name=twitter:description content="Throughout project development we use Jenkins to provide meaningful test feedback on each Git push event. These builds are required to gain sufficient confidence for merging into master and subsequent deployment. Each team member manages their own project with the current project/branch they are working on. However, typically we find ourselves working on multiple branches throughout the day, and it can become cumbersome to update the project’s configuration."><meta name=twitter:site content="@edd_mann"><link rel="preload stylesheet" as=style href=/css/style.min.a5107d712048e2bf498ca68b768b337bccdd6ce7b257419de1c0762b86ab1143.css integrity="sha256-pRB9cSBI4r9JjKaLdosze8zdbOeyV0Gd4cB2K4arEUM="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/managing-jenkins-project-builds-and-configuration-using-php/></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><div class=site-header__mobile-navigation-button aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></div><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1>Managing Jenkins Project Builds and Configuration using PHP</h1><time class=post__time>Jul 8, 2015</time></header><main class=prose><p>Throughout project development we use Jenkins to provide meaningful test feedback on each Git push event.
These builds are required to gain sufficient confidence for merging into <em>master</em> and subsequent deployment.
Each team member manages their own project with the current project/branch they are working on.
However, typically we find ourselves working on multiple branches throughout the day, and it can become cumbersome to update the project&rsquo;s configuration.</p><p>I decided to create a simple PHP console script that can be run (or added as a git-hook) to maintain synchronisation between the branch you are working on and the branch Jenkins is building.
Whilst developing this script, it dawned on me that many other automated use cases could be achieved with the ability to easily update a project&rsquo;s configuration file.
For this reason I have provided the full script in question at the end of the post, but I wish to discuss important areas in more detail throughout.</p><h2 id=reading-the-projects-configuration>Reading the Projects Configuration</h2><p>Jenkins fortunately provides us with a RESTful interface to manage typical tasks and activities.
Included in this is the ability to read the XML configuration file for a specified project.
In this use case we are only concerned with accessing the currently configured Git branch name.</p><pre tabindex=0><code class="language-php?start_inline=1" data-lang="php?start_inline=1">$curl = curl_init(url(&#39;config.xml&#39;));

curl_setopt_array($curl, array(
    CURLOPT_RETURNTRANSFER =&gt; true,
    CURLOPT_HEADER =&gt; false,
    CURLOPT_FOLLOWLOCATION =&gt; true,
));

$config = new SimpleXMLElement(curl_exec($curl));

$jobBranch = (string) $config-&gt;scm-&gt;branches-&gt;{&#39;hudson.plugins.git.BranchSpec&#39;}-&gt;name;
</code></pre><h2 id=writing-to-the-projects-configuration>Writing to the Projects Configuration</h2><p>Now that we have access to the current project&rsquo;s configuration XML, we can update the specified branch as desired.
To achieve this we are required to POST the updated configuration file back to the API, as shown below.</p><pre tabindex=0><code class="language-php?start_inline=1" data-lang="php?start_inline=1">$config-&gt;scm-&gt;branches-&gt;{&#39;hudson.plugins.git.BranchSpec&#39;}-&gt;name = $localBranch;

$fh = fopen(&#39;php://memory&#39;, &#39;rw&#39;);
fwrite($fh, $xml = $config-&gt;asXML());
rewind($fh);

curl_setopt_array($curl, array(
    CURLOPT_HTTPHEADER =&gt; array(&#39;Content-type: application/xml&#39;),
    CURLOPT_INFILE =&gt; $fh,
    CURLOPT_INFILESIZE =&gt; strlen($xml),
    CURLOPT_UPLOAD =&gt; true,
    CURLOPT_CUSTOMREQUEST =&gt; &#39;POST&#39;,
));

curl_exec($curl);
</code></pre><h2 id=sending-a-project-build-request>Sending a Project Build Request</h2><p>With the updated branch configuration now in place, we can send Jenkins a request to start a new build of the project.
This can be simply achieved by updating the current cURL instance and making a POST request to the build API endpoint.</p><pre tabindex=0><code class="language-php?start_inline=1" data-lang="php?start_inline=1">curl_setopt_array($curl, array(
    CURLOPT_URL =&gt; url(&#39;build&#39;),
    CURLOPT_CUSTOMREQUEST =&gt; &#39;POST&#39;,
));

curl_exec($curl);
</code></pre><h2 id=the-full-script>The Full Script</h2><p>Using these examples we are now able to combine them, solving the use case laid out at the start of the post.
By accessing a specified project&rsquo;s configuration file, we check to see if the branch is the same as the one we are locally using.
If this is not the case we update the configuration XML and then ask the user if they wish to trigger a build of the project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>.bash_profile
</span></span></span><span style=display:flex><span><span style=color:#75715e>export JENKINS_AUTH=&#34;username:secretkey&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>export JENKINS_JOB=&#34;Jenkins-Project&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>export JENKINS_URL=&#34;jenkins.example.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>url</span>($path)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sprintf</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;http://%s@%s/job/%s/%s&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;JENKINS_AUTH&#39;</span>), <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;JENKINS_URL&#39;</span>), <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;JENKINS_JOB&#39;</span>), $path
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// read branch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$curl <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>(<span style=color:#a6e22e>url</span>(<span style=color:#e6db74>&#39;config.xml&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>curl_setopt_array</span>($curl, <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_RETURNTRANSFER</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_HEADER</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_FOLLOWLOCATION</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SimpleXMLElement</span>(<span style=color:#a6e22e>curl_exec</span>($curl));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$localBranch <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>(<span style=color:#a6e22e>shell_exec</span>(<span style=color:#e6db74>&#39;git rev-parse --abbrev-ref HEAD&#39;</span>));
</span></span><span style=display:flex><span>$jobBranch <span style=color:#f92672>=</span> (<span style=color:#a6e22e>string</span>) $config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scm</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>branches</span><span style=color:#f92672>-&gt;</span>{<span style=color:#e6db74>&#39;hudson.plugins.git.BranchSpec&#39;</span>}<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($localBranch <span style=color:#f92672>===</span> $jobBranch) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $localBranch, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>goto</span> <span style=color:#a6e22e>build</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// rename branch
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>$config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scm</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>branches</span><span style=color:#f92672>-&gt;</span>{<span style=color:#e6db74>&#39;hudson.plugins.git.BranchSpec&#39;</span>}<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> $localBranch;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$fh <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#39;php://memory&#39;</span>, <span style=color:#e6db74>&#39;rw&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>fwrite</span>($fh, $xml <span style=color:#f92672>=</span> $config<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>asXML</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>rewind</span>($fh);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>curl_setopt_array</span>($curl, <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_HTTPHEADER</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;Content-type: application/xml&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_INFILE</span> <span style=color:#f92672>=&gt;</span> $fh,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_INFILESIZE</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>strlen</span>($xml),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_UPLOAD</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CURLOPT_CUSTOMREQUEST</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>curl_exec</span>($curl);
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$jobBranch</span><span style=color:#e6db74> -&gt; </span><span style=color:#e6db74>$localBranch\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// GOTO: eeeeewwwwww......
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>build</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Would you like to perform a build? (y/[n]) &#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>trim</span>(<span style=color:#a6e22e>fgets</span>(<span style=color:#a6e22e>STDIN</span>)) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;y&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>curl_setopt_array</span>($curl, <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CURLOPT_URL</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>url</span>(<span style=color:#e6db74>&#39;build&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CURLOPT_CUSTOMREQUEST</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>curl_exec</span>($curl);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Sent build request</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>curl_close</span>($curl);
</span></span></code></pre></div><p>An interesting point to highlight with regard to the full version is the use of defined environment variables to access the current Jenkins setup.
This is useful as it allows you to publish the script without any requirement to amend it, along with the ability to override configuration on a per-execution basis.
Finally, the comical use of the &lsquo;goto&rsquo; statement to change execution flow based on whether the configuration file requires modification or not.
This should obviously not be used in production code but, within a small script such as this, it has its uses.</p></main><footer class=post__tags><a href=/archive/tag/jenkins>jenkins</a><a href=/archive/tag/php>php</a></footer></article><div class=scroll-watcher></div></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div></footer><script>(function(){document.querySelector(".site-header__mobile-navigation-button").addEventListener("click",e=>{document.documentElement.classList.toggle("mobile-navigation-open"),e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")});const n=document.querySelector(".site-header");let t=window.pageYOffset,e=!1;window.addEventListener("scroll",()=>{if(e)return;setTimeout(()=>{const s=window.pageYOffset;n.classList.toggle("is-sticky",s>0&&t>s),t=s,e=!1},500),e=!0})})()</script></body></html>