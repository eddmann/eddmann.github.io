<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Advent of Code 2015 - Day 22 - Wizard Simulator 20XX - Edd Mann</title>
<meta name=description content="Solving the Advent of Code 2015 Day 22 puzzle using TypeScript."><meta name=author content="Edd Mann"><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPQ7WHNXH4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPQ7WHNXH4")}</script><meta itemprop=name content="Advent of Code 2015 - Day 22 - Wizard Simulator 20XX"><meta itemprop=description content="On the twenty-second day of Advent of Code 2015, we are asked to help ‘Little Henry Case’ beat the boss in another video game he is stuck on."><meta itemprop=datePublished content="2021-02-17T00:00:00+00:00"><meta itemprop=dateModified content="2021-02-17T00:00:00+00:00"><meta itemprop=wordCount content="1354"><meta itemprop=keywords content="Advent-of-Code,Advent-of-Code-2015,Typescript"><meta property="og:url" content="https://eddmann.com/posts/advent-of-code-2015-day-22-wizard-simulator-20xx/"><meta property="og:site_name" content="Edd Mann"><meta property="og:title" content="Advent of Code 2015 - Day 22 - Wizard Simulator 20XX"><meta property="og:description" content="On the twenty-second day of Advent of Code 2015, we are asked to help ‘Little Henry Case’ beat the boss in another video game he is stuck on."><meta property="og:locale" content="en_GB"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-17T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-17T00:00:00+00:00"><meta property="article:tag" content="Advent-of-Code"><meta property="article:tag" content="Advent-of-Code-2015"><meta property="article:tag" content="Typescript"><meta name=twitter:card content="summary"><meta name=twitter:title content="Advent of Code 2015 - Day 22 - Wizard Simulator 20XX"><meta name=twitter:description content="On the twenty-second day of Advent of Code 2015, we are asked to help ‘Little Henry Case’ beat the boss in another video game he is stuck on."><meta name=twitter:site content="@edd_mann"><link rel=stylesheet href=/css/style.min.020af028a86e4141eddb604604567804a169da6a588b326f18d39cd2db3b5eb4.css integrity="sha256-AgrwKKhuQUHt22BGBFZ4BKFp2mpYizJvGNOc0ts7XrQ="><link rel=preload as=image href=/assets/x.svg><link rel=preload as=image href=/assets/github.svg><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://eddmann.com/posts/advent-of-code-2015-day-22-wizard-simulator-20xx/><script>(function(){document.documentElement.setAttribute("data-theme",localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: dark)").matches&&"dark"||"light")})()</script><script src=/script.min.1052707861642a4eb63c758a2c16cbf5deb3b3ea2582f09f743a7d4c55fb9828.js integrity="sha256-EFJweGFkKk62PHWKLBbL9d6zs+olgvCfdDp9TFX7mCg=" defer></script></head><body><header class="site-header wrapper"><a href=https://eddmann.com/><h3 class=site-header__title>Edd Mann
<span style=--url:url(/assets/code.svg)>Developer</span></h3></a><button class=site-header__mobile-navigation-button type=button title="Toggle mobile site navigation" aria-label="Toggle mobile site navigation" aria-expanded=false aria-controls=site-navigation></button><div class=site-header__navigation id=site-navigation><nav aria-label="Primary navigation"><ul class=site-header__primary-navigation><li><a href=/archive>Archive</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><nav aria-label="Social links"><ul class=site-header__social-navigation><li><a class=social-icon style=--url:url(/assets/x.svg) href=https://x.com/edd_mann rel="external noopener" target=_blank>Twitter (X)</a></li><li><a class=social-icon style=--url:url(/assets/github.svg) href=https://github.com/eddmann rel="external noopener" target=_blank>GitHub</a></li></ul></nav></div></header><main class=wrapper><article><header class=page-title><h1 class=transition-between-pages style=--id:advent-of-code-2015-day-22-wizard-simulator-20xx>Advent of Code 2015 - Day 22 - Wizard Simulator 20XX</h1><time datetime=2021-02-17T00:00:00Z class=post__time>Feb 17, 2021</time></header><main class=prose><p>On the twenty-second day of Advent of Code 2015, we are asked to help &lsquo;Little Henry Case&rsquo; beat the boss in another video game he is stuck on.</p><h2 id=part-1>Part 1</h2><p>Like the <a href=/posts/advent-of-code-2015-day-21-rpg-simulator-20xx/>previous day</a>, the game is turn-based.
However, this time we are able to spend <em>mana</em> in exchange for spells we can cast per round.
Certain spells have the ability to cause effects that can last between rounds.
Due to this, we are unable to formulate the battle into a single calculation, so instead, we must simulate a given battle in its entirety.
For part one, we are asked to work out the minimum amount of <em>mana</em> we can spend and still win the battle.</p><p>Based on the rules laid out within the <a href=https://adventofcode.com/2015/day/22 rel="external noopener" target=_blank>problem specification</a>, we begin by modelling how spells will be represented.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Spell</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>spells</span>: <span style=color:#66d9ef>Spell</span>[] <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Magic Missile&#39;</span>, <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>53</span>, <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>4</span>, <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>1</span> },
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Drain&#39;</span>, <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>73</span>, <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>2</span>, <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>2</span>, <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>1</span> },
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Shield&#39;</span>, <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>113</span>, <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>7</span>, <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>6</span> },
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Poison&#39;</span>, <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>173</span>, <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>3</span>, <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>6</span> },
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Recharge&#39;</span>, <span style=color:#a6e22e>cost</span>: <span style=color:#66d9ef>229</span>, <span style=color:#a6e22e>damage</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>armor</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>heal</span>: <span style=color:#66d9ef>0</span>, <span style=color:#a6e22e>mana</span>: <span style=color:#66d9ef>101</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>5</span> },
</span></span><span style=display:flex><span>];
</span></span></code></pre></div><p>This approach opts to normalise all the possible spell behaviours, creating no-op actions by way of zero values.
From here, we model how we wish to store the state of a battle throughout gameplay.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BattleState</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>playerMana</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>playerArmor</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bossHp</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bossDamage</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>manaSpent</span>: <span style=color:#66d9ef>number</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>activeEffects</span>: <span style=color:#66d9ef>Spell</span>[];
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>There are a couple of rules around which spells are available for a player to cast at a given point in the battle.
These include whether they have enough mana to purchase the spell and if the spell is an effect that is either not active or on its last turn.
We will next translate these rules into a function that we can supply the current <code>BattleState</code> to and return the possible <code>Spell</code> listing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hasBattleEnded</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>BattleState</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>bossHp</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>playerHp</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getAvailableSpells</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>BattleState</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Spell</span>[] <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>hasBattleEnded</span>(<span style=color:#a6e22e>state</span>)) <span style=color:#66d9ef>return</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>spells</span>.<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>spell</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>active</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>.<span style=color:#a6e22e>find</span>(<span style=color:#a6e22e>effect</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>spell</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>effect</span>.<span style=color:#a6e22e>name</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>spell</span>.<span style=color:#a6e22e>cost</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>playerMana</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>active</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>active</span>.<span style=color:#a6e22e>turns</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>This leads us to being able to start codifying the steps that a given battle round takes.
We will start by building out all the desired steps as isolated immutable state transitions.
First, we will handle how we apply effects before each participant&rsquo;s turn.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BattleTransition</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>BattleState</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>BattleState</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>enactEffects</span>: <span style=color:#66d9ef>BattleTransition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>hasBattleEnded</span>(<span style=color:#a6e22e>state</span>)) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerMana</span>: <span style=color:#66d9ef>state.playerMana</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>sumProp</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>, <span style=color:#e6db74>&#39;mana&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerArmor</span>: <span style=color:#66d9ef>sumProp</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>, <span style=color:#e6db74>&#39;armor&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bossHp</span>: <span style=color:#66d9ef>state.bossHp</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>sumProp</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>, <span style=color:#e6db74>&#39;damage&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeEffects</span>: <span style=color:#66d9ef>state.activeEffects.reduce</span>(
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>effects</span>, <span style=color:#a6e22e>effect</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>effect</span>.<span style=color:#a6e22e>turns</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> [...<span style=color:#a6e22e>effects</span>, { ...<span style=color:#a6e22e>effect</span>, <span style=color:#a6e22e>turns</span>: <span style=color:#66d9ef>effect.turns</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> }] <span style=color:#f92672>:</span> <span style=color:#a6e22e>effects</span>,
</span></span><span style=display:flex><span>      []
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>We have used the same <code>sumProp</code> function found in the <a href=/posts/advent-of-code-2015-day-21-rpg-simulator-20xx/>previous day&rsquo;s</a> solution to help tally a collection&rsquo;s property values.
Next, we will handle how a player&rsquo;s turn updates the battle state.
We supply a given <code>Spell</code> we wish the player to cast for this round and return a <code>BattleTransition</code> similar to enacting effects.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>playerTurn</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>spell</span>: <span style=color:#66d9ef>Spell</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>BattleTransition</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>hasBattleEnded</span>(<span style=color:#a6e22e>state</span>)) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isSpellEffect</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spell</span>.<span style=color:#a6e22e>turns</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>state.playerHp</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>isSpellEffect</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>0</span> : <span style=color:#66d9ef>spell.heal</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerMana</span>: <span style=color:#66d9ef>state.playerMana</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>spell</span>.<span style=color:#a6e22e>cost</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bossHp</span>: <span style=color:#66d9ef>state.bossHp</span> <span style=color:#f92672>-</span> (<span style=color:#a6e22e>isSpellEffect</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>0</span> : <span style=color:#66d9ef>spell.damage</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>manaSpent</span>: <span style=color:#66d9ef>state.manaSpent</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>spell</span>.<span style=color:#a6e22e>cost</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeEffects</span>: <span style=color:#66d9ef>isSpellEffect</span> <span style=color:#f92672>?</span> [...<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>, <span style=color:#a6e22e>spell</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>activeEffects</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Following on from the player&rsquo;s turn, we can now model how a boss&rsquo;s turn updates the battle state.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bossTurn</span>: <span style=color:#66d9ef>BattleTransition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>hasBattleEnded</span>(<span style=color:#a6e22e>state</span>)) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>state.playerHp</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>bossDamage</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>playerArmor</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>With the core steps in place, modelled uniformly as <code>BattleTransition</code> types, we can begin to think about how we wish to stitch these together.
When reading the problem definition, I thought it would be an ideal fit to employ composable state transitions.
To wire these together, I&rsquo;ve opted to use a small <code>pipe</code> helper function, which works in the opposite manner to a conventional <code>compose</code>.
Instead of being called <em>right-to-left</em>, the pipe function composes the provided functions <em>left-to-right</em>, which reads more naturally.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pipe</span> <span style=color:#f92672>=</span> &lt;<span style=color:#f92672>R</span>&gt;(<span style=color:#a6e22e>fn1</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>R</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>R</span>, ...<span style=color:#a6e22e>fns</span>: <span style=color:#66d9ef>Array</span><span style=color:#f92672>&lt;</span>(<span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>R</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>R</span><span style=color:#f92672>&gt;</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fns</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>prevFn</span>, <span style=color:#a6e22e>nextFn</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>nextFn</span>(<span style=color:#a6e22e>prevFn</span>(<span style=color:#a6e22e>value</span>)), <span style=color:#a6e22e>fn1</span>);
</span></span></code></pre></div><p>Using this <code>pipe</code> function, we can build up the steps required to complete a <em>round</em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BattleRound</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>spell</span>: <span style=color:#66d9ef>Spell</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>BattleTransition</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>roundOfBattle</span>: <span style=color:#66d9ef>BattleRound</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spell</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>enactEffects</span>, <span style=color:#a6e22e>playerTurn</span>(<span style=color:#a6e22e>spell</span>), <span style=color:#a6e22e>enactEffects</span>, <span style=color:#a6e22e>bossTurn</span>);
</span></span></code></pre></div><p>With the round simulation modelled, we can work on a solution to determine the minimum mana required to win the battle.
To do this, we will use a recursive function that takes in a <code>BattleConfiguration</code> and <code>BattleRound</code> function like so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>BattleConfiguration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Pick</span>&lt;<span style=color:#f92672>BattleState</span>, <span style=color:#e6db74>&#39;playerHp&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;playerMana&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;bossHp&#39;</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#e6db74>&#39;bossDamage&#39;</span>&gt;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isPlayerWinner</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>BattleState</span>) <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hasBattleEnded</span>(<span style=color:#a6e22e>state</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>playerHp</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>minManaSpent</span> <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>configuration</span>: <span style=color:#66d9ef>BattleConfiguration</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>round</span>: <span style=color:#66d9ef>BattleRound</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>minMana</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Infinity</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>recur</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>: <span style=color:#66d9ef>BattleState</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>manaSpent</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>minMana</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>getAvailableSpells</span>(<span style=color:#a6e22e>state</span>).<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isPlayerWinner</span>(<span style=color:#a6e22e>state</span>)) <span style=color:#a6e22e>minMana</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>manaSpent</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>spell</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>getAvailableSpells</span>(<span style=color:#a6e22e>state</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>recur</span>(<span style=color:#a6e22e>round</span>(<span style=color:#a6e22e>spell</span>)(<span style=color:#a6e22e>state</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>recur</span>({
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>configuration</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerArmor</span>: <span style=color:#66d9ef>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>manaSpent</span>: <span style=color:#66d9ef>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeEffects</span><span style=color:#f92672>:</span> [],
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>minMana</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>The <code>BattleConfiguration</code> is a <a href=https://www.typescriptlang.org/docs/handbook/utility-types.html#picktype-keys rel="external noopener" target=_blank>subset type</a> of the <code>BattleState</code>, allowing us to supply the battle properties that define the participants&rsquo; characteristics.
The <code>BattleRound</code> function allows us to supply the <code>roundOfBattle</code> function we created earlier to simulate each given round&rsquo;s state transition.
To locate the minimum amount of mana required, we store the current minimum mana for a winning battle and <em>prune</em> out any branches that exceed this amount until no enactable branches remain.
This allows us to limit the scope of the problem greatly, as upon the first winning game, we have a baseline to <em>prune</em> out any game that exceeds that mana spent.</p><p>With this in place, we can parse the boss&rsquo;s characteristics from the supplied input and execute the <code>minManaSpent</code> function to find the desired answer 🌟.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>part1</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>input</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>bossHp</span>, <span style=color:#a6e22e>bossDamage</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/(\d+)/gm</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>toInt</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>minManaSpent</span>(
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>50</span>, <span style=color:#a6e22e>playerMana</span>: <span style=color:#66d9ef>500</span>, <span style=color:#a6e22e>bossHp</span>, <span style=color:#a6e22e>bossDamage</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>roundOfBattle</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=part-2>Part 2</h2><p>For part two, we are required to expand upon the game we created in part one.
We are now to create a <em>Hard Mode</em>, in which, at the start of each round, the player&rsquo;s health is reduced by one HP.
Based on this addition, we need to determine the revised minimum mana spent required to still win the battle.</p><p>We will first create the additional <code>BattleTransition</code> step, defining how Hard Mode modifies the battle state.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>applyHardMode</span>: <span style=color:#66d9ef>BattleTransition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=&gt;</span> ({
</span></span><span style=display:flex><span>  ...<span style=color:#a6e22e>state</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>state.playerHp</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>From this, we can create a new <em>round of battle</em> function, which pipes the <code>BattleState</code> to the <code>applyHardMode</code> function before continuing with the original game.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hardRoundOfBattle</span>: <span style=color:#66d9ef>BattleRound</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spell</span> <span style=color:#f92672>=&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pipe</span>(<span style=color:#a6e22e>applyHardMode</span>, <span style=color:#a6e22e>roundOfBattle</span>(<span style=color:#a6e22e>spell</span>));
</span></span></code></pre></div><p>We can then use the same setup as we did for part one, instead supplying the new <code>hardRoundOfBattle</code> function.
In doing so, we get the desired answer to the question 🌟.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>part2</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>input</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>bossHp</span>, <span style=color:#a6e22e>bossDamage</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/(\d+)/gm</span>).<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>toInt</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>minManaSpent</span>(
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>playerHp</span>: <span style=color:#66d9ef>50</span>, <span style=color:#a6e22e>playerMana</span>: <span style=color:#66d9ef>500</span>, <span style=color:#a6e22e>bossHp</span>, <span style=color:#a6e22e>bossDamage</span> },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hardRoundOfBattle</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>I found today&rsquo;s core problem did not take too long to devise (the minimum pruning technique).
However, simulating the game took the majority of the time.
As mentioned when reading the problem definition, I felt there could be a means to provide an elegant, composable solution for representing the steps required to perform a round of battle.
I&rsquo;m happy with how the <code>BattleTransition</code> type has been employed, lending itself well to the <code>pipe</code> operation.
Reading both the <code>roundOfBattle</code> and <code>hardRoundOfBattle</code> functions clearly expresses their intent and the stages of a round.</p></main><footer class=post__tags><a href=/archive/tag/advent-of-code>advent-of-code</a><a href=/archive/tag/advent-of-code-2015>advent-of-code-2015</a><a href=/archive/tag/typescript>typescript</a></footer></article><div class="related-posts prose"><h3>Related Posts</h3><ul><li><a href=/posts/advent-of-code-2015-day-21-rpg-simulator-20xx/>Advent of Code 2015 - Day 21 - RPG Simulator 20XX</a></li><li><a href=/posts/advent-of-code-2015-day-20-infinite-elves-and-infinite-houses/>Advent of Code 2015 - Day 20 - Infinite Elves and Infinite Houses</a></li><li><a href=/posts/advent-of-code-2015-day-19-medicine-for-rudolph/>Advent of Code 2015 - Day 19 - Medicine for Rudolph</a></li><li><a href=/posts/advent-of-code-2015-day-18-like-a-gif-for-your-yard/>Advent of Code 2015 - Day 18 - Like a GIF For Your Yard</a></li><li><a href=/posts/advent-of-code-2015-day-17-no-such-thing-as-too-much/>Advent of Code 2015 - Day 17 - No Such Thing as Too Much</a></li></ul></div><div class=scroll-watcher></div></main><footer class="site-footer wrapper"><div>&copy; 2025, Edd Mann</div><button class=theme-toggle type=button title="Toggle theme" aria-label="Toggle theme"><svg fill="currentcolor" viewBox="0 0 32 32" role="img"><title>Theme toggle icon</title><desc>A circle representing the moon for toggling theme</desc><path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z"/></svg></button></footer></body></html>