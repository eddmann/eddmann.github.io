<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Exploration of the Maybe type in JavaScript">

    <title>
        
            Maybe in JavaScript &middot; Edd Mann
        
    </title>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    <script>
        var _gaq=[['_setAccount','UA-32512081-1'],['_setDomainName','eddmann.com'],['_trackPageview']];
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = 'https://ssl.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Maybe in JavaScript</h1>
    <time datetime="2016-06-08T00:00:00+00:00" class="post-date">08 Jun 2016</time>
    <p>Recently I have been delving into the concepts of <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids">Functors</a> and <a href="http://learnyouahaskell.com/a-fistful-of-monads">Monads</a>.
There are many good <a href="https://curiosity-driven.org/monads-in-javascript">resources</a> available online that will do a far better job of explaining these concepts than me, however, I do wish to document an example Maybe type I have implemented in JavaScript.
Again, there are many good external <a href="http://sean.voisen.org/blog/2013/10/intro-monads-maybe/">resources</a> which highlight the characteristics and power of using such a type, so I will direct your attention to those if you wish to learn more.
</p>

<h3 id="implementation">Implementation</h3>

<p>The Maybe type encapsulates the concept of Some (contains a value) and None (no value present).
With these two abstractions we are able to safety handle the event of no value being present, without NullPointerException’s being thrown and null checks.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Maybe</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Some</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">Some</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fmap</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">Maybe</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">));</span> <span class="p">};</span>
  <span class="nx">Some</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="p">};</span>
  <span class="nx">Some</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">`Some(</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="p">}</span><span class="s2">)`</span><span class="p">;</span> <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">None</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{};</span>
  <span class="nx">None</span><span class="p">.</span><span class="nx">fmap</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">None</span><span class="p">;</span>
  <span class="nx">None</span><span class="p">.</span><span class="nx">bind</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">None</span><span class="p">;</span>
  <span class="nx">None</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="dl">'</span><span class="s1">None</span><span class="dl">'</span><span class="p">;</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">of</span><span class="p">:</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">x</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="p">?</span> <span class="nx">None</span> <span class="p">:</span> <span class="k">new</span> <span class="nx">Some</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span>
    <span class="na">lift</span><span class="p">:</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Maybe</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">fn</span><span class="p">(...</span><span class="nx">args</span><span class="p">)),</span>
    <span class="nx">Some</span><span class="p">,</span>
    <span class="nx">None</span>
  <span class="p">};</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>The implementation above uses two small prototypical class definitions to define Some and None.
We then return the ability to take a value of a plain type and put it into a Maybe container, along with the capability to lift a function into the Maybe space.</p>

<h3 id="division-by-zero-example">Division by Zero Example</h3>

<p>The first example of using the Maybe type I will demonstrate is in the case of handling division by zero errors.
In the event that the denominator is zero instead of throwing an exception or returning null (as shown in the basic <code class="language-plaintext highlighter-rouge">div</code> implementation) we will instead lift the function into the Maybe type and return a Some or None.
This may not seem like much of a win at this time but when we later look at examples of composing these expressions together you will be shown its full power.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">b</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">a</span> <span class="o">/</span> <span class="nx">b</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">mdiv</span> <span class="o">=</span> <span class="nx">Maybe</span><span class="p">.</span><span class="nx">lift</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>

<span class="nx">div</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// null</span>
<span class="nx">mdiv</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// None</span>
<span class="nx">mdiv</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Some(5)</span>
</code></pre></div></div>

<h3 id="property-retrieval-example">Property Retrieval Example</h3>

<p>Another case were <code class="language-plaintext highlighter-rouge">undefined</code> values may appear in JavaScript is whilst retrieving properties from objects that may(not) be present.
Again, we are able to highlight how the basic <code class="language-plaintext highlighter-rouge">get</code> function returns the object property or undefined if not present, were as lifting it into the Maybe type provides us with the Some and None abstractions.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="kd">get</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">prop</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">mget</span> <span class="o">=</span> <span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Maybe</span><span class="p">.</span><span class="nx">lift</span><span class="p">(</span><span class="kd">get</span><span class="p">(</span><span class="nx">prop</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Joe Bloggs</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
  <span class="na">address</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">street</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Cinder Drive</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">agez</span><span class="dl">'</span><span class="p">)(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// undefined</span>
<span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">agez</span><span class="dl">'</span><span class="p">)(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// None</span>
<span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">age</span><span class="dl">'</span><span class="p">)(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// Some(25)</span>
</code></pre></div></div>

<p>We are then able to compose multiple <code class="language-plaintext highlighter-rouge">mget</code> functions together, handling application on the Maybe containers using <code class="language-plaintext highlighter-rouge">fmap</code> and <code class="language-plaintext highlighter-rouge">bind</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fmap</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">functor</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">functor</span><span class="p">.</span><span class="nx">fmap</span><span class="p">(</span><span class="nx">fn</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">bind</span> <span class="o">=</span> <span class="nx">curry</span><span class="p">((</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">monad</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">monad</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">fn</span><span class="p">));</span>
</code></pre></div></div>

<p>You will notice that <code class="language-plaintext highlighter-rouge">fmap</code> double wraps the resulting value, this is due to as being a Functor definition its’ action is to wrap the resulting value (from our provided function) back into the given container.
However, in the case of the <code class="language-plaintext highlighter-rouge">bind</code> Monad definition, it instead does not wrap the value back into the container upon completion, but instead relies on the function itself to return the correctly typed value.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">getStreet</span> <span class="o">=</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">fmap</span><span class="p">(</span><span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">street</span><span class="dl">'</span><span class="p">)),</span> <span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">address</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">getStreet</span><span class="p">({</span> <span class="na">address</span><span class="p">:</span> <span class="p">{}</span> <span class="p">});</span> <span class="c1">// Some(None)</span>
<span class="nx">getStreet</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// Some(Some(Cinder Drive))</span>

<span class="kd">const</span> <span class="nx">getStreet</span> <span class="o">=</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">bind</span><span class="p">(</span><span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">street</span><span class="dl">'</span><span class="p">)),</span> <span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">address</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">getStreet</span><span class="p">({</span> <span class="na">address</span><span class="p">:</span> <span class="p">{}</span> <span class="p">});</span> <span class="c1">// None</span>
<span class="nx">getStreet</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// Some(Cinder Drive)</span>
</code></pre></div></div>

<h3 id="mimicking-do-notation-in-javascript">Mimicking Do Notation in JavaScript</h3>

<p>You will notice when looking through Haskell examples how succinct the do notation is at handling the containers used.
We are able to take advantage of the ability to phase JavaScript functions as strings to rewrite a language similar to this notation into one that can be executed.
This allows us to clearly express the intent of the code as opposed to muddling it with the plumbing required to make it work with the containers.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">doM</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">tokenize</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exp</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">exp</span>
    <span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/</span><span class="se">[\n</span><span class="sr">;</span><span class="se">]</span><span class="sr">/</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">trim</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">evaluate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tokens</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="dl">''</span><span class="p">;</span>

    <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="nx">match</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^return </span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr">$/</span><span class="p">))</span>
      <span class="k">return</span> <span class="s2">`return Maybe.of(</span><span class="p">${</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="s2">);`</span> <span class="o">+</span> <span class="nx">evaluate</span><span class="p">(</span><span class="nx">tokens</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr"> &lt;= </span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr">$/</span><span class="p">))</span>
      <span class="k">return</span> <span class="s2">`return </span><span class="p">${</span><span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span><span class="s2">.bind(function(</span><span class="p">${</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span><span class="s2">) { </span><span class="p">${</span><span class="nx">evaluate</span><span class="p">(</span><span class="nx">tokens</span><span class="p">)}</span><span class="s2"> });`</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">evaluate</span><span class="p">(</span><span class="nx">tokens</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">compose</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">(),</span> <span class="nb">Function</span><span class="p">,</span> <span class="nx">evaluate</span><span class="p">,</span> <span class="nx">tokenize</span><span class="p">);</span>
<span class="p">})();</span>

<span class="nx">doM</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">address</span> <span class="o">&lt;=</span> <span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">address</span><span class="dl">'</span><span class="p">)(</span><span class="nx">user</span><span class="p">)</span>
  <span class="nx">street</span> <span class="o">&lt;=</span> <span class="nx">mget</span><span class="p">(</span><span class="dl">'</span><span class="s1">street</span><span class="dl">'</span><span class="p">)(</span><span class="nx">address</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">street</span>
<span class="p">});</span> <span class="c1">// Some(Cinder Drive)</span>
</code></pre></div></div>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
