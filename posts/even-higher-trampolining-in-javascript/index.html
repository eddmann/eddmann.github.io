<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Discover advanced trampolining techniques in JavaScript with an enhanced abstraction for managing function return types, improving both clarity and performance.">

    <title>
        
            Even Higher Trampolining in JavaScript &middot; Edd Mann
        
    </title>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    

    <script>
        var _gaq=[['_setAccount','UA-32512081-1'],['_setDomainName','eddmann.com'],['_trackPageview']];
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = 'https://ssl.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Even Higher Trampolining in JavaScript</h1>
    <time datetime="2016-01-08T00:00:00+00:00" class="post-date">08 Jan 2016</time>
    <p>The concept of <em>trampolining</em> seems to have been a running trend throughout this week.
I noted in my initial article on implementing trampolining in JavaScript that I would document a revised version capable of handling the case when a function is the desired return type. 
Taking an idea found in the Clojure documentation for this function, I decided to provide a simple abstraction over the process which wraps the <em>thunk</em> or <em>result</em> in a two-element array data structure.
This allows us to pass along the additional knowledge of whether the user’s desired action is to continue (‘cont’) or complete (‘done’) back to the trampoline, so that we can make the correct decision.
This approach also has the added bonus of being more expressive in its intent, thanks to the additional functions being used.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">trampoline</span> <span class="o">=</span> <span class="nx">bounce</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="p">[</span><span class="nx">isRunning</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bounce</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">isRunning</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">isRunning</span><span class="p">,</span> <span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">trampoline</span><span class="p">.</span><span class="nx">cont</span> <span class="o">=</span> <span class="nx">thunk</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="nx">thunk</span><span class="p">];</span>
<span class="nx">trampoline</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="kc">false</span><span class="p">,</span> <span class="nx">result</span><span class="p">];</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">odd</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">=&gt;</span>
  <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">trampoline</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="p">:</span> <span class="nx">trampoline</span><span class="p">.</span><span class="nx">cont</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">even</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">even</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">=&gt;</span>
  <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="nx">trampoline</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">:</span> <span class="nx">trampoline</span><span class="p">.</span><span class="nx">cont</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">odd</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>

<span class="nx">trampoline</span><span class="p">(</span><span class="nx">odd</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
</code></pre></div></div>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
