<!doctype html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Solving the Advent of Code 2015 Day 13 puzzle using TypeScript">

    <title>
        
            Advent of Code 2015 - Day 13 - Knights of the Dinner Table &middot; Edd Mann
        
    </title>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/styles.css">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="alternate" href="/rss.xml" title="" type="application/rss+xml">

    

    <script>
        var _gaq=[['_setAccount','UA-32512081-1'],['_setDomainName','eddmann.com'],['_trackPageview']];
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = 'https://ssl.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>

    <body>
        <div class="container content">
            <header class="masthead">
                <h3 class="masthead-title">
                    <a href="/" title="Home">Edd Mann</a>
                    <small><i class="fa fa-code"></i> Developer</small>
                </h3>
                <nav>
                    <a href="https://twitter.com/edd_mann"><i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/eddmann"><i class="fa fa-github"></i></a>
                    <a href="mailto:the@eddmann.com"><i class="fa fa-envelope"></i></a>
                </nav>
                <div class="cf"></div>
            </header>

            <main>
                <article class="post">
    <h1 class="post-title">Advent of Code 2015 - Day 13 - Knights of the Dinner Table</h1>
    <time datetime="2021-02-06T00:00:00+00:00" class="post-date">06 Feb 2021</time>
    <p>On the thirteenth day of Advent of Code 2015 we are tasked with finding the optimal seating arrangement for our family <em>holiday feast</em>.</p>



<h3 id="part-1">Part 1</h3>

<p>We are provided with a listings of all our family members and their relationships with each other.
These relationships come in the form of a happiness score which can be either positive or negative.
We are tasked with determining the happiness total of the optimial seating arrangment.</p>

<p>My initial reaction to this problem is that it shows a great similarity to <a href="https://eddmann.com/posts/advent-of-code-2015-day-9-all-in-a-single-night/">Day 9</a>.
Like before, we initially begin by parsing the provided input into a form we can use.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">FamilyMember</span> <span class="o">=</span> <span class="kr">string</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">Neighbours</span> <span class="o">=</span> <span class="kr">string</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">Happiness</span> <span class="o">=</span> <span class="kr">number</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">Relationships</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">family</span><span class="p">:</span> <span class="nb">Set</span><span class="o">&lt;</span><span class="nx">FamilyMember</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="nl">relationships</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="nx">Neighbours</span><span class="p">,</span> <span class="nx">Happiness</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">parseFamilyRelationships</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">Relationships</span> <span class="o">=&gt;</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span>
    <span class="p">({</span> <span class="nx">family</span><span class="p">,</span> <span class="nx">relationships</span> <span class="p">},</span> <span class="nx">line</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">[,</span> <span class="nx">member</span><span class="p">,</span> <span class="nx">feeling</span><span class="p">,</span> <span class="nx">score</span><span class="p">,</span> <span class="nx">nextTo</span><span class="p">]</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span>
        <span class="sr">/</span><span class="se">(\w</span><span class="sr">+</span><span class="se">)</span><span class="sr"> .+ </span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr"> </span><span class="se">(\d</span><span class="sr">+</span><span class="se">)</span><span class="sr"> .+ </span><span class="se">(\w</span><span class="sr">+</span><span class="se">)</span><span class="sr">/</span>
      <span class="p">);</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="na">family</span><span class="p">:</span> <span class="nx">family</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">member</span><span class="p">),</span>
        <span class="na">relationships</span><span class="p">:</span> <span class="nx">relationships</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span>
          <span class="s2">`</span><span class="p">${</span><span class="nx">member</span><span class="p">}</span><span class="s2">,</span><span class="p">${</span><span class="nx">nextTo</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
          <span class="nx">feeling</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">gain</span><span class="dl">'</span> <span class="p">?</span> <span class="o">+</span><span class="nx">score</span> <span class="p">:</span> <span class="o">-</span><span class="nx">score</span>
        <span class="p">),</span>
      <span class="p">};</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">family</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Set</span><span class="o">&lt;</span><span class="nx">FamilyMember</span><span class="o">&gt;</span><span class="p">(),</span>
      <span class="na">relationships</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="nx">Neighbours</span><span class="p">,</span> <span class="nx">Happiness</span><span class="o">&gt;</span><span class="p">(),</span>
    <span class="p">}</span>
  <span class="p">);</span>
</code></pre></div></div>

<p>Like in Day 9, we reduce over the listing building up both a <em>set</em> of all the family members and a <em>map</em> of the relationship happiness scores.
Unlike the previous day, I have decided to opt for a single-level map which provides the associations in the form of <code class="language-plaintext highlighter-rouge">Neighbours</code> strings.
As an aside, Iâ€™ve really enjoyed being able to map the problem domain into types of which I can construct the behaviour from.
I find great value in being able to type-aliase primitives such as numbers and strings to the domain language.</p>

<p>With the input now parsed we can move on to calculating the seating happiness scores.
The input listing is not that large so again we can use the <code class="language-plaintext highlighter-rouge">permutations</code> function we implemented in Day 9 to iterate over every possible seating arrangement.
For each given arrangement we then calculate its total happiness score.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">calcSeatingHappiness</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">family</span><span class="p">,</span>
  <span class="nx">relationships</span><span class="p">,</span>
<span class="p">}:</span> <span class="nx">Relationships</span><span class="p">):</span> <span class="nx">Happiness</span><span class="p">[]</span> <span class="o">=&gt;</span>
  <span class="p">[...</span><span class="nx">permutations</span><span class="p">([...</span><span class="nx">family</span><span class="p">])].</span><span class="nx">map</span><span class="p">(</span><span class="nx">a</span> <span class="o">=&gt;</span>
    <span class="nx">zip</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="p">[...</span><span class="nx">a</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]).</span><span class="nx">reduce</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">score</span><span class="p">,</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">])</span> <span class="o">=&gt;</span>
        <span class="nx">score</span> <span class="o">+</span>
        <span class="nx">relationships</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">a</span><span class="p">}</span><span class="s2">,</span><span class="p">${</span><span class="nx">b</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span> <span class="o">+</span>
        <span class="nx">relationships</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">b</span><span class="p">}</span><span class="s2">,</span><span class="p">${</span><span class="nx">a</span><span class="p">}</span><span class="s2">`</span><span class="p">),</span>
      <span class="mi">0</span>
    <span class="p">)</span>
  <span class="p">);</span>
</code></pre></div></div>

<p>Instead of <em>piggy-backing</em> on the reduction to include the previous family member (like we did in Day 9) I decided to implement a <code class="language-plaintext highlighter-rouge">zip</code> function which returned a tuple of each seat neighbours (gracefully handling the circular nature of the table).
These neighbouring tuples are then reduced over to produce the total happiness score for that given arrangement.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">zip</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nx">A</span><span class="p">[],</span> <span class="nx">b</span><span class="p">:</span> <span class="nx">B</span><span class="p">[]):</span> <span class="p">[</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">][]</span> <span class="o">=&gt;</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">[</span><span class="nx">idx</span><span class="p">]]);</span>
</code></pre></div></div>

<p>Whilst solving this problem I encoutered an issue when using JavaScripts <code class="language-plaintext highlighter-rouge">Math.max</code> and the size of the possible arrangement happiness scores.
Due to the nature in which <code class="language-plaintext highlighter-rouge">Math.max</code> (and <code class="language-plaintext highlighter-rouge">Math.min</code>) uses a multi-arity argument approach to supplying input, their is a finite amount of arguments that it can take till it exceeds the call-stack limit.
For this problem I encounted this issue and as such was required to implement an alternative approach.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">max</span> <span class="o">=</span> <span class="p">(</span><span class="nx">xs</span><span class="p">:</span> <span class="kr">number</span><span class="p">[])</span> <span class="o">=&gt;</span>
  <span class="nx">xs</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">m</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">m</span> <span class="p">?</span> <span class="nx">x</span> <span class="p">:</span> <span class="nx">m</span><span class="p">),</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">);</span>
</code></pre></div></div>

<p>With this custom <code class="language-plaintext highlighter-rouge">max</code> implementation we can now compose all the building blocks together and return the desired answer ðŸŒŸ.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span>
  <span class="nx">max</span><span class="p">(</span><span class="nx">calcSeatingHappiness</span><span class="p">(</span><span class="nx">parseFamilyRelationships</span><span class="p">(</span><span class="nx">input</span><span class="p">)));</span>
</code></pre></div></div>

<h3 id="part-2">Part 2</h3>

<p>To solve part two we are required to add ourselves to the seating arrangement; with neutral (<code class="language-plaintext highlighter-rouge">0</code>) happiness scores for all family members.
Once added we are required to then determine what the new optimial seating arrangement happiness score will be.
We can sovle this in a similiar mannor to how we did for part one ðŸŒŸ.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">family</span><span class="p">,</span> <span class="nx">relationships</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">parseFamilyRelationships</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">scores</span> <span class="o">=</span> <span class="nx">calcSeatingHappiness</span><span class="p">({</span>
    <span class="na">relationships</span><span class="p">:</span> <span class="p">[...</span><span class="nx">family</span><span class="p">].</span><span class="nx">reduce</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">relationships</span><span class="p">,</span> <span class="nx">member</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">relationships</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="s2">`Me,</span><span class="p">${</span><span class="nx">member</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="kd">set</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">member</span><span class="p">}</span><span class="s2">,Me`</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
      <span class="nx">relationships</span>
    <span class="p">),</span>
    <span class="na">family</span><span class="p">:</span> <span class="nx">family</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">Me</span><span class="dl">'</span><span class="p">),</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">max</span><span class="p">(</span><span class="nx">scores</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

</article>

            </main>

            <footer class="footer">
                <img src="https://www.gravatar.com/avatar/c5c2978bb14d16460f73399c394b6acd?s=160">
                <ul>
                    <li>Developer at <a href="http://www.mybuilder.com/">MyBuilder</a></li>
                    <li><a href="http://threedevsandamaybe.com/">Three Devs and a Maybe</a> podcast co-host</li>
                    <li>All ramblings can be found in the <a href="/archive/">Archive</a></li>
                </ul>
                <div class="cf"></div>
            </footer>
        </div>
    </body>
</html>
